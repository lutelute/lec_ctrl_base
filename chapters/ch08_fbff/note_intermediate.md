# 第8章 FB制御とFF制御 - 中級編

## 1. ブロック線図による表現

制御系を理解するために、**ブロック線図（Block Diagram）** を使って信号の流れを可視化します。

### 基本的な信号の記号

制御系では、以下の信号記号を使用します：

- $$r(t)$$：**目標値（Reference）** - 達成したい目標
- $$y(t)$$：**出力（Output）** - 実際の結果
- $$e(t)$$：**偏差（Error）** - 目標と出力の差 $$e(t) = r(t) - y(t)$$
- $$u(t)$$：**操作量（Control Input）** - 制御器が出す指令
- $$d(t)$$：**外乱（Disturbance）** - 予期しない変化

### ラプラス変換表記

周波数領域での解析のため、以下の記号を使用します：

- $$R(s)$$、$$Y(s)$$、$$E(s)$$、$$U(s)$$、$$D(s)$$：各信号のラプラス変換
- $$G(s)$$：**プラント（制御対象）の伝達関数**
- $$C(s)$$：**コントローラ（制御器）の伝達関数**
- $$F(s)$$：**フィードフォワード補償器の伝達関数**

## 2. フィードフォワード制御（FF制御）

### 2.1 FF制御のブロック線図

```
         F(s)
R(s) ----[FF補償器]----> U(s) ----[プラント G(s)]----> Y(s)
                                          ↑
                                        D(s) 外乱
```

**特徴**：
- 出力 $$Y(s)$$ からのフィードバック経路がない（開ループ）
- 目標値 $$R(s)$$ から直接操作量 $$U(s)$$ を計算
- 外乱 $$D(s)$$ の影響を測定できない

### 2.2 FF制御の伝達関数

操作量は次のように計算されます：

$$U(s) = F(s) \cdot R(s)$$

出力は以下の式で表されます：

$$Y(s) = G(s) \cdot U(s) + G(s) \cdot D(s)$$

$$Y(s) = G(s) \cdot F(s) \cdot R(s) + G(s) \cdot D(s)$$

**目標値から出力への伝達関数**（外乱なしの場合）：

$$\frac{Y(s)}{R(s)} = G(s) \cdot F(s)$$

### 2.3 理想的なFF補償器の設計

目標値に完全に追従するには、$$Y(s) = R(s)$$ となる必要があります。

$$G(s) \cdot F(s) = 1$$

$$F(s) = \frac{1}{G(s)} = G(s)^{-1}$$

これは **プラントの逆モデル** を使うことを意味します。

**問題点**：
1. $$G(s)$$ が正確にわかっていないと、誤差が生じる
2. $$G(s)$$ の逆系が物理的に実現できない場合がある（非因果的、不安定など）
3. 外乱 $$D(s)$$ には全く対応できない

### 2.4 外乱に対する応答

外乱が入力された場合：

$$Y(s) = G(s) \cdot F(s) \cdot R(s) + G(s) \cdot D(s)$$

外乱による出力への影響：

$$\frac{Y(s)}{D(s)} = G(s)$$

**結論**：FF制御では、外乱がそのままプラントを通過して出力に現れます。

## 3. フィードバック制御（FB制御）

### 3.1 FB制御のブロック線図

```
R(s) ---->(+)----> E(s) ----[コントローラ C(s)]----> U(s) ----[プラント G(s)]----> Y(s)
          (-)                                                       ↑                   |
           ↑                                                      D(s)                  |
           |                                                                            |
           └────────────────────────────────────────────────────────────────────────────┘
```

**特徴**：
- 出力 $$Y(s)$$ を測定してフィードバック
- 偏差 $$E(s) = R(s) - Y(s)$$ を計算
- 偏差を小さくするように操作量 $$U(s)$$ を調整
- ループが閉じている（閉ループ）

### 3.2 FB制御の伝達関数

偏差は次のように計算されます：

$$E(s) = R(s) - Y(s)$$

操作量は：

$$U(s) = C(s) \cdot E(s) = C(s) \cdot (R(s) - Y(s))$$

出力は：

$$Y(s) = G(s) \cdot U(s) + G(s) \cdot D(s)$$

$$Y(s) = G(s) \cdot C(s) \cdot (R(s) - Y(s)) + G(s) \cdot D(s)$$

整理すると：

$$Y(s) + G(s) \cdot C(s) \cdot Y(s) = G(s) \cdot C(s) \cdot R(s) + G(s) \cdot D(s)$$

$$Y(s) \cdot (1 + G(s) \cdot C(s)) = G(s) \cdot C(s) \cdot R(s) + G(s) \cdot D(s)$$

### 3.3 閉ループ伝達関数

**目標値から出力への伝達関数**（外乱なしの場合）：

$$\frac{Y(s)}{R(s)} = \frac{G(s) \cdot C(s)}{1 + G(s) \cdot C(s)}$$

**外乱から出力への伝達関数**（目標値なしの場合）：

$$\frac{Y(s)}{D(s)} = \frac{G(s)}{1 + G(s) \cdot C(s)}$$

### 3.4 フィードバックの効果

分母に $$1 + G(s) \cdot C(s)$$ という項が現れます。これを **ループゲイン** と呼びます。

**ループゲインが大きい場合**（$$|G(s) \cdot C(s)| \gg 1$$）：

1. **目標値追従性能**：
   $$\frac{Y(s)}{R(s)} \approx \frac{G(s) \cdot C(s)}{G(s) \cdot C(s)} = 1$$

   出力が目標値にほぼ一致します。

2. **外乱抑制性能**：
   $$\frac{Y(s)}{D(s)} \approx \frac{G(s)}{G(s) \cdot C(s)} = \frac{1}{C(s)}$$

   外乱の影響が $$C(s)$$ の分だけ小さくなります。

**結論**：FB制御では、ループゲインを大きくすることで、目標値追従性能と外乱抑制性能の両方が向上します。

## 4. FF制御とFB制御の数学的比較

### 4.1 目標値応答の比較

| 項目 | FF制御 | FB制御 |
|------|--------|--------|
| 伝達関数 | $$\frac{Y(s)}{R(s)} = G(s) \cdot F(s)$$ | $$\frac{Y(s)}{R(s)} = \frac{G(s) \cdot C(s)}{1 + G(s) \cdot C(s)}$$ |
| 理想条件 | $$F(s) = G(s)^{-1}$$ のとき $$Y(s) = R(s)$$ | $$\|G(s) \cdot C(s)\| \gg 1$$ のとき $$Y(s) \approx R(s)$$ |
| モデル誤差 | $$G(s)$$ の誤差が直接影響 | ループゲインで誤差を低減 |
| 応答速度 | プラントの動特性のみ | コントローラで調整可能 |

### 4.2 外乱抑制性能の比較

| 項目 | FF制御 | FB制御 |
|------|--------|--------|
| 伝達関数 | $$\frac{Y(s)}{D(s)} = G(s)$$ | $$\frac{Y(s)}{D(s)} = \frac{G(s)}{1 + G(s) \cdot C(s)}$$ |
| 外乱の影響 | 抑制なし（$$D(s)$$ がそのまま出力に現れる） | ループゲインで抑制 |
| 外乱除去 | 不可能 | $$\|G(s) \cdot C(s)\| \gg 1$$ で大幅に低減 |

### 4.3 総合比較表

| 特性 | FF制御 | FB制御 | 備考 |
|------|--------|--------|------|
| **構造** | 開ループ | 閉ループ | FFは一方通行、FBは循環 |
| **センサー** | 不要 | 必要 | FBは出力測定が必須 |
| **モデル精度** | 高精度が必要 | 多少の誤差は許容 | FBはフィードバックで補正 |
| **外乱対応** | 不可 | 可能 | FBは外乱を測定して対応 |
| **安定性** | 常に安定 | 設計次第で不安定化 | FBは設計が重要 |
| **応答速度** | 速い | やや遅い | FBは測定・判断の遅れがある |
| **実装コスト** | 低い | 高い | センサーと計算が必要 |
| **適用場面** | 簡易な制御 | 高精度・高信頼性が必要 | |

## 5. 2自由度制御（2DOF制御）

### 5.1 2DOF制御の基本概念

**2自由度制御（Two-Degree-of-Freedom Control, 2DOF）** は、FF制御とFB制御を **組み合わせた制御方式** です。

**目的**：
- FF制御の **速い応答** を活かす
- FB制御の **外乱抑制** と **精度** を活かす
- 両方の長所を組み合わせる

### 5.2 2DOF制御のブロック線図

```
         FF(s)
R(s) ----[FF補償器]----->(+)
          |               |
          |              U(s) ----[プラント G(s)]----> Y(s)
          |               ↑                ↑              |
          |             (+)              D(s)             |
          |               |                               |
          └-->[FB補償器]--┘                               |
              C(s) ←─────── E(s) ←───(-)─────────────────┘
                                    (+)
                                     ↑
                                   R(s)
```

より見やすい形式：

```
R(s) ----[FF(s)]---->(+)----> U(s) ----[G(s)]----> Y(s)
  |                   ↑                               |
  |                   |                               |
  └---->(-)---> E(s)--[C(s)]                          |
        (+)                                           |
         ↑                                            |
         └────────────────────────────────────────────┘
```

### 5.3 2DOF制御の伝達関数

偏差は：

$$E(s) = R(s) - Y(s)$$

操作量は FF制御と FB制御の和：

$$U(s) = FF(s) \cdot R(s) + C(s) \cdot E(s)$$

$$U(s) = FF(s) \cdot R(s) + C(s) \cdot (R(s) - Y(s))$$

出力は：

$$Y(s) = G(s) \cdot U(s) + G(s) \cdot D(s)$$

$$Y(s) = G(s) \cdot (FF(s) \cdot R(s) + C(s) \cdot (R(s) - Y(s))) + G(s) \cdot D(s)$$

整理すると：

$$Y(s) \cdot (1 + G(s) \cdot C(s)) = G(s) \cdot (FF(s) + C(s)) \cdot R(s) + G(s) \cdot D(s)$$

**目標値から出力への伝達関数**：

$$\frac{Y(s)}{R(s)} = \frac{G(s) \cdot (FF(s) + C(s))}{1 + G(s) \cdot C(s)}$$

**外乱から出力への伝達関数**：

$$\frac{Y(s)}{D(s)} = \frac{G(s)}{1 + G(s) \cdot C(s)}$$

### 5.4 2DOF制御の設計思想

**重要な観察**：

1. **外乱抑制性能** は FB制御部分のみで決まる：
   $$\frac{Y(s)}{D(s)} = \frac{G(s)}{1 + G(s) \cdot C(s)}$$

   これは純粋な FB制御と同じ形です。

2. **目標値追従性能** は FF制御と FB制御の両方で調整可能：
   $$\frac{Y(s)}{R(s)} = \frac{G(s) \cdot (FF(s) + C(s))}{1 + G(s) \cdot C(s)}$$

**設計手順**：

1. **Step 1**：FB制御器 $$C(s)$$ を設計
   - 安定性を確保
   - 外乱抑制性能を満たす

2. **Step 2**：FF補償器 $$FF(s)$$ を設計
   - 目標値追従性能を改善
   - 応答速度を向上

**理想的な FF補償器**：

目標値応答を理想的にするには：

$$\frac{Y(s)}{R(s)} = 1$$

これより：

$$G(s) \cdot (FF(s) + C(s)) = 1 + G(s) \cdot C(s)$$

$$FF(s) = \frac{1 + G(s) \cdot C(s)}{G(s)} - C(s) = \frac{1}{G(s)}$$

つまり、理想的には $$FF(s) = G(s)^{-1}$$ となります。

### 5.5 2DOF制御の利点

| 利点 | 説明 |
|------|------|
| **速い応答** | FF制御により、目標値に素早く近づく |
| **高精度** | FB制御により、誤差を確実に小さくする |
| **外乱抑制** | FB制御により、外乱の影響を低減 |
| **モデル誤差の補償** | FB制御により、FFの不完全さを補う |
| **独立設計** | FFとFBを独立に設計できる |

### 5.6 実用例

**ハードディスクのヘッド位置決め**：
- FF制御：目標トラックまで素早く移動
- FB制御：正確な位置に微調整

**ロボットアームの軌道追従**：
- FF制御：計画した軌道に沿って動く
- FB制御：誤差を補正して精度を保つ

**自動車の車線維持支援**：
- FF制御：道路の曲率に応じてステアリング
- FB制御：実際の車線からのずれを補正

## 6. 感度関数と相補感度関数

### 6.1 感度関数（Sensitivity Function）

**感度関数** $$S(s)$$ は、外乱が出力に与える影響を表します：

$$S(s) = \frac{1}{1 + G(s) \cdot C(s)}$$

**性質**：
- $$|S(s)|$$ が小さいほど、外乱抑制性能が高い
- 低周波数で $$|S(s)|$$ を小さくすることが目標

### 6.2 相補感度関数（Complementary Sensitivity Function）

**相補感度関数** $$T(s)$$ は、目標値追従性能を表します：

$$T(s) = \frac{G(s) \cdot C(s)}{1 + G(s) \cdot C(s)} = 1 - S(s)$$

**性質**：
- $$|T(s)| \approx 1$$ のとき、目標値に追従
- 高周波数で $$|T(s)|$$ を小さくすることが重要（ノイズ増幅を防ぐ）

### 6.3 トレードオフ

$$S(s) + T(s) = 1$$

という関係があり、これは **ウォーターベッド効果** と呼ばれます：

- ある周波数で $$S(s)$$ を小さくすると、別の周波数で大きくなる
- $$S(s)$$ と $$T(s)$$ の両方を同時に小さくすることはできない

**制御設計の本質**：
- どの周波数帯域で外乱抑制を優先するか
- どの周波数帯域で目標値追従を優先するか
- このバランスを取ることが制御設計の核心

---

## まとめ

この章では、FB制御とFF制御を数学的に表現し、その特性を比較しました：

- **ブロック線図と伝達関数**：
  - FF制御：$$\frac{Y(s)}{R(s)} = G(s) \cdot F(s)$$、外乱抑制なし
  - FB制御：$$\frac{Y(s)}{R(s)} = \frac{G(s) \cdot C(s)}{1 + G(s) \cdot C(s)}$$、外乱抑制あり

- **比較**：
  - FF制御：速いが外乱に弱い、モデル精度が必要
  - FB制御：精度が高く外乱に強いが、やや遅く複雑

- **2自由度制御**：
  - FF制御とFB制御を組み合わせる
  - FFで速さ、FBで精度と外乱抑制
  - 独立に設計できる

- **感度関数**：
  - $$S(s)$$：外乱抑制性能を表す
  - $$T(s)$$：目標値追従性能を表す
  - $$S(s) + T(s) = 1$$ のトレードオフ

次の理解者向け技術ノートでは、安定性解析、外乱抑制理論、2自由度制御の具体的な設計手法について、さらに詳しく学んでいきます。
