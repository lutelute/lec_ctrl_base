# 第1章 制御工学の全体像 - 中級編

## 1. フィードバック制御システムの数学的構造

フィードバック制御システムは、数学的にブロック図で表現されます。ここでは信号の流れと数式の関係を理解しましょう。

### ブロック図の読み方と描き方

フィードバック制御システムの基本的なブロック図は以下のように表されます：

```
        +      e(t)         u(t)          y(t)
r(t) ──>○──> [Controller] ──> [Plant] ──> 出力
        -│         C               P        │
         │                                  │
         └──────────────────────────────────┘
                    フィードバックパス
```

各記号の意味：
- $r(t)$：目標値（Reference / 設定値）
- $e(t)$：誤差信号（Error）
- $u(t)$：制御入力（Control input）
- $y(t)$：出力（Output / 制御量）

### 信号の流れ

フィードバック制御システムでは、信号が以下のように流れます：

$$r(t) \to e(t) \to u(t) \to y(t)$$

1. **目標値** $r(t)$ が与えられる
2. **誤差信号** $e(t)$ が計算される
3. **制御入力** $u(t)$ がコントローラで生成される
4. **出力** $y(t)$ が制御対象から得られる
5. 出力がフィードバックされ、誤差が再計算される

### 誤差信号の定義

フィードバック制御の核心は、**誤差信号** $e(t)$ です：

$$e(t) = r(t) - y(t)$$

これは「目標値と現在値の差」を表します。制御の目的は、この誤差を小さくすることです。

### 閉ループシステムの特徴

閉ループ（フィードバック制御）システムには以下の特徴があります：

- **自己修正能力**：誤差を検出して自動的に修正
- **外乱抑制**：予期しない外乱の影響を低減
- **モデル誤差への耐性**：制御対象のモデルが不正確でも動作
- **安定性の問題**：フィードバックにより不安定になる可能性も

## 2. フィードフォワード制御との比較

制御方式には、フィードバック制御の他に**フィードフォワード制御（Feedforward Control）**があります。

### フィードフォワード制御の構造

フィードフォワード制御は、出力を測定せずに制御入力を決定します：

```
r(t) ──> [Controller] ──> [Plant] ──> y(t)
             C_ff             P
```

出力 $y(t)$ から入力へのフィードバックパスが**ありません**。

### フィードバック制御との違い

| 比較項目 | フィードバック制御 | フィードフォワード制御 |
|---------|------------------|---------------------|
| 出力測定 | 必要（センサが必須） | 不要 |
| 外乱への対応 | 強い（自動的に補正） | 弱い（予測できない外乱に対応不可） |
| モデル精度の要求 | 低い（多少不正確でもOK） | 高い（正確なモデルが必須） |
| 応答速度 | 遅れが生じる | 即座に応答 |
| 安定性 | 不安定化の可能性あり | 安定（開ループなので） |
| コスト | 高い（センサが必要） | 低い |

### それぞれの長所と短所

**フィードバック制御の長所**
- 外乱やモデル誤差に対してロバスト（頑健）
- 自動的に誤差を修正

**フィードバック制御の短所**
- センサが必要でコストが高い
- フィードバックによる遅れが生じる
- 設計が不適切だと不安定化する

**フィードフォワード制御の長所**
- 応答が速い（遅れがない）
- 安定性の問題がない
- センサ不要でシンプル

**フィードフォワード制御の短所**
- 正確なモデルが必要
- 外乱やモデル誤差に弱い
- 予測できない変化に対応できない

### 組み合わせ（2自由度制御）の概念

実際の制御系では、両方を組み合わせることが多いです：

```
r(t) ──> [C_ff] ──┐
                  ↓ +
        ┌───> [C_fb] ──> [Plant] ──> y(t)
        │                   P         │
        └───────────────────────────┘
               フィードバック
```

- **フィードフォワード（$C_{ff}$）**：目標値への追従を高速化
- **フィードバック（$C_{fb}$）**：外乱やモデル誤差を補正

これにより、「速さ」と「正確さ」の両方を実現できます。

## 3. 制御システムの構成要素（数学的観点）

ここでは、制御システムの各要素を数学的に表現します。

### 制御対象（プラント）$P$

制御対象は、入力 $u(t)$ を受けて出力 $y(t)$ を生成するシステムです：

$$y(t) = P \cdot u(t)$$

より一般的には、制御対象は**動的システム**であり、微分方程式で記述されます：

$$\frac{dy(t)}{dt} = f(y(t), u(t), t)$$

例：質量 $m$ の物体に力 $u(t)$ を加える場合

$$m \frac{d^2 y(t)}{dt^2} = u(t)$$

### コントローラ $C$

コントローラは、誤差信号 $e(t)$ を入力として制御入力 $u(t)$ を生成します：

$$u(t) = C \cdot e(t)$$

最も基本的なコントローラは**比例（P）コントローラ**です：

$$u(t) = K_p \cdot e(t)$$

ここで $K_p$ は比例ゲインです。誤差が大きいほど、強く制御します。

より高度なコントローラには以下があります：
- **PI（比例＋積分）コントローラ**：$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau$
- **PID（比例＋積分＋微分）コントローラ**：$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$

### センサ・アクチュエータのモデル化

実際の制御系では、センサとアクチュエータも動的特性を持ちます：

**センサのモデル**
- 理想的：$y_{measured}(t) = y(t)$
- 実際：遅れやノイズがある

**アクチュエータのモデル**
- 理想的：指令通りに動く
- 実際：飽和（制限）や遅れがある

### 外乱 $d(t)$ と観測雑音 $n(t)$

実システムには、制御を妨げる要因があります：

**外乱（Disturbance）** $d(t)$
- 制御対象に加わる予期しない入力
- 例：風の影響、負荷変動

**観測雑音（Measurement Noise）** $n(t)$
- センサの測定誤差
- 例：電気ノイズ、量子化誤差

これらを含めた制御系の式：

$$y(t) = P \cdot u(t) + d(t)$$
$$y_{measured}(t) = y(t) + n(t)$$

## 4. 開ループ系と閉ループ系

制御系は、フィードバックの有無により大きく2つに分類されます。

### 開ループ系（Open-loop System）の定義と特性

**定義**：出力を測定せずに、入力のみで制御する系

$$y(t) = P \cdot u(t)$$

**特性**
- 制御入力 $u(t)$ は目標値 $r(t)$ のみから決定される
- 出力 $y(t)$ の情報は使われない
- システムは「開いて」いる（フィードバックループが閉じていない）

**利点**
- 構成がシンプル
- 低コスト
- 安定性の問題がない

**欠点**
- 外乱に弱い
- モデル誤差に弱い
- 経年変化に対応できない

### 閉ループ系（Closed-loop System）の定義と特性

**定義**：出力を測定し、フィードバックして制御する系

$$e(t) = r(t) - y(t)$$
$$u(t) = C \cdot e(t)$$
$$y(t) = P \cdot u(t)$$

これらを組み合わせると、閉ループ伝達関数が得られます（詳細は第2章以降で学習）。

**特性**
- 出力 $y(t)$ を測定し、誤差 $e(t)$ を計算
- 誤差に基づいて制御入力 $u(t)$ を調整
- システムがループで「閉じて」いる

**利点**
- 外乱に強い（自動補正）
- モデル誤差に強い
- 経年変化にも対応可能

**欠点**
- センサが必要
- 設計が難しい（不安定化の可能性）
- コストが高い

### 閉ループによるロバスト性の向上

**ロバスト性（Robustness）**とは、不確かさや外乱に対する頑健性のことです。

**例：モータの位置制御**

開ループの場合：
- 負荷が変わると、同じ電圧でも回転角が変わる
- モデル（負荷の大きさ）が不正確だと、目標位置からずれる

閉ループの場合：
- 位置センサで実際の位置を測定
- ずれがあれば自動的に補正
- 負荷が変わっても目標位置に到達できる

このように、フィードバック制御は**モデルの不確かさ**や**外乱**に対して、システムを頑健（ロバスト）にします。

### まとめ：開ループと閉ループの使い分け

| 状況 | 推奨される方式 |
|------|-------------|
| 環境が一定で外乱が少ない | 開ループ（シンプルで安い） |
| 外乱が多い、精度が重要 | 閉ループ（ロバストで正確） |
| モデルが正確に分かっている | 開ループまたはフィードフォワード |
| モデルに不確かさがある | 閉ループ（フィードバック） |
| 高速応答が必要 | フィードフォワード＋フィードバックの併用 |

---

## まとめ

この中級編では、制御工学の基本概念を数学的に表現しました：

- **数学的構造**：信号の流れ $r(t) \to e(t) \to u(t) \to y(t)$ と誤差信号 $e(t) = r(t) - y(t)$
- **フィードフォワードとの比較**：それぞれの長所・短所と2自由度制御
- **構成要素の数学的観点**：プラント $P$、コントローラ $C$、外乱 $d(t)$、観測雑音 $n(t)$
- **開ループ系と閉ループ系**：フィードバックの有無による違いとロバスト性

これらの数学的基礎を理解することで、より高度な制御理論（ラプラス変換、伝達関数、周波数応答など）を学ぶ準備が整います。

次の理解者編では、実際の制御系設計の8ステップと具体的な応用例を学びます。
