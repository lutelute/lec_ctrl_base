# 第1章 制御工学の全体像 - 理解者向け技術ノート

## 1. 制御系設計の8ステップ

制御系を実際に設計・実装するためには、体系的なアプローチが必要です。ここでは、モデリングから実装・評価に至るまでの8ステップのプロセスを詳しく解説します。

### Step 1: 制御目的の明確化

**目的**：何を達成したいのかを明確にする

制御系設計の最初のステップは、制御の目的を具体的に定義することです：

- **制御量の特定**：何を制御するのか（温度、位置、速度、圧力など）
- **制御目標の設定**：どのような状態を実現したいのか
- **性能要求の定義**：応答速度、精度、安定性などの要求仕様

**例**：モータ位置制御システムの場合
- 制御量：モータの回転角度 $\theta(t)$
- 制御目標：指定された角度に正確に移動する
- 性能要求：整定時間 < 1秒、オーバーシュート < 10%、定常偏差 < 0.5度

### Step 2: システム同定・モデリング

**目的**：制御対象の動的特性を数学的に表現する

制御対象の物理的な振る舞いを数学モデルとして記述します：

- **物理法則の適用**：運動方程式、熱力学、電気回路理論など
- **実験データからの同定**：ステップ応答、周波数応答などの測定
- **モデルの簡略化**：設計に必要な精度とのバランス

**例**：DCモータのモデリング
- 電気的特性：$L\frac{di}{dt} + Ri = V - K_e\omega$
- 機械的特性：$J\frac{d\omega}{dt} + B\omega = K_t i$
- ここで、$V$は電圧、$i$は電流、$\omega$は角速度、$\theta$は角度

### Step 3: 制御仕様の設定

**目的**：具体的な設計指標を数値化する

制御系の性能を定量的に評価するための指標を設定します：

- **時間領域仕様**
  - 立ち上がり時間（Rise time）：目標値の10%から90%に達するまでの時間
  - 整定時間（Settling time）：目標値の±2%以内に収まるまでの時間
  - オーバーシュート（Overshoot）：目標値を超える最大値の割合
  - 定常偏差（Steady-state error）：最終的な目標値との誤差

- **周波数領域仕様**
  - ゲイン余裕（Gain margin）：安定性の余裕度
  - 位相余裕（Phase margin）：安定性の余裕度
  - 帯域幅（Bandwidth）：制御系の応答速度の指標

### Step 4: 制御方式の選定

**目的**：適切な制御アルゴリズムを選択する

制御目的と制御対象の特性に応じて、最適な制御方式を選びます：

- **PID制御**：最も広く使われる古典制御手法
  - P（比例）：現在の誤差に比例した制御
  - I（積分）：過去の誤差の累積を補正（定常偏差の除去）
  - D（微分）：誤差の変化率に基づく予測制御

- **状態フィードバック制御**：システムの内部状態を利用

- **最適制御**：評価関数を最小化する制御（LQR、LQGなど）

- **ロバスト制御**：モデル誤差や外乱に強い制御（H∞制御など）

- **適応制御**：パラメータが変化するシステムへの対応

### Step 5: コントローラの設計

**目的**：選定した制御方式に基づいてパラメータを決定する

制御器のゲインやパラメータを具体的に計算します：

**PID制御の場合**

$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

パラメータ $K_p$, $K_i$, $K_d$ の調整方法：
- **理論的手法**：根軌跡法、周波数応答法、極配置法
- **経験的手法**：Ziegler-Nicholsの調整則
- **最適化手法**：評価関数の最小化

**状態フィードバック制御の場合**

$$u(t) = -Kx(t)$$

フィードバックゲイン行列 $K$ の設計：
- 極配置法：閉ループ系の極を望ましい位置に配置
- LQR（Linear Quadratic Regulator）：二次評価関数の最小化

### Step 6: シミュレーション検証

**目的**：設計した制御系の性能を事前に確認する

実装前に、計算機上で制御系の動作を検証します：

- **ステップ応答のシミュレーション**
  - 目標値への追従性能の確認
  - オーバーシュート、整定時間の測定

- **外乱応答のシミュレーション**
  - 外乱抑制性能の確認
  - ロバスト性の評価

- **感度解析**
  - パラメータ変動の影響評価
  - 最悪ケースの検討

- **非線形性の考慮**
  - 飽和、不感帯などの影響
  - 安定性の再確認

### Step 7: 実装・チューニング

**目的**：実際のシステムに制御器を組み込み、調整する

設計した制御器を実システムに実装し、実際の動作を確認します：

- **ハードウェア実装**
  - マイコン、DSP、PLCへのプログラム実装
  - サンプリング周期の決定
  - アンチワインドアップ対策（積分飽和の防止）

- **初期調整**
  - 安全性の確認（低ゲインから始める）
  - 段階的なゲイン調整

- **現地チューニング**
  - シミュレーションとの差異の補正
  - 実環境での最適化

### Step 8: 評価・改善

**目的**：実運用での性能を評価し、継続的に改善する

実装後の制御系の性能を評価し、必要に応じて改善を行います：

- **性能評価**
  - 制御仕様の達成度確認
  - 定常運転時の性能測定
  - 異常時の動作確認

- **問題の特定**
  - 性能不足の原因分析
  - 外乱やノイズの影響評価

- **改善サイクル**
  - パラメータの再調整
  - 制御方式の見直し
  - モデルの精緻化

このように、制御系設計は一度きりのプロセスではなく、**評価→改善→再設計**の継続的なサイクルです。

## 2. モデリングの重要性

制御系設計において、**モデリング（Modeling）**は最も重要なステップの一つです。正確なモデルがなければ、効果的な制御器を設計することはできません。

### 物理モデルと数学モデル

**物理モデル（Physical Model）**
- 実際のシステムの物理的な構造や原理を表現
- 例：質量・ばね・ダンパー系、電気回路、熱伝導系

**数学モデル（Mathematical Model）**
- 物理モデルを数式で表現したもの
- 微分方程式、伝達関数、状態方程式など

**モデリングのアプローチ**

1. **第一原理モデリング（First-principles modeling）**
   - 物理法則（ニュートンの運動方程式、キルヒホッフの法則など）から導出
   - 物理的な意味が明確
   - 例：質量 $m$ の物体に力 $F$ を加える
     $$m\frac{d^2x}{dt^2} = F$$

2. **実験的システム同定（System identification）**
   - 入出力データから数学モデルを推定
   - 複雑なシステムに有効
   - ステップ応答法、周波数応答法、ARXモデルなど

3. **データ駆動モデリング（Data-driven modeling）**
   - 機械学習を用いたモデル構築
   - ニューラルネットワーク、ガウス過程など
   - 物理的解釈が難しいが、高精度なモデル化が可能

### 伝達関数表現と状態空間表現（概要）

制御系のモデルを表現する主な方法は2つあります：

**伝達関数表現（Transfer Function）**

ラプラス変換を用いた入出力関係の表現（詳細は第2章）：

$$G(s) = \frac{Y(s)}{U(s)}$$

- 利点：直感的で理解しやすい、周波数応答解析が容易
- 欠点：単入力単出力（SISO）系に限定、初期値を扱いにくい

**状態空間表現（State-Space Representation）**

システムの内部状態を用いた表現：

$$\frac{dx(t)}{dt} = Ax(t) + Bu(t)$$
$$y(t) = Cx(t) + Du(t)$$

- 利点：多入力多出力（MIMO）系に対応、現代制御理論の基礎
- 欠点：直感的理解が難しい、モデル次数が高くなる

### モデルの精度とトレードオフ

**モデルの精度とは**
- 実システムの動的特性をどれだけ正確に再現できるか
- 高精度モデル：詳細な振る舞いまで表現（高次元）
- 簡略モデル：主要な特性のみ表現（低次元）

**トレードオフの考慮**

| 項目 | 高精度モデル | 簡略モデル |
|------|------------|----------|
| 予測精度 | 高い | やや低い |
| モデル次数 | 高次（計算コスト大） | 低次（計算コスト小） |
| パラメータ数 | 多い（同定困難） | 少ない（同定容易） |
| 設計の容易さ | 難しい | 容易 |
| ロバスト性 | モデル化誤差が小さい | モデル化誤差が大きい |

**実用上の指針**
- 制御目的に必要十分な精度を持つ最も簡単なモデルを使用
- 「すべてのモデルは間違っているが、役に立つものもある」（George Box）
- フィードバック制御は、ある程度のモデル誤差を補償できる

**モデリングの注意点**
- 無視した動特性（高周波モード、非線形性など）が制御性能に影響を与える可能性
- モデルとプラントのミスマッチをロバスト制御で補償
- 実験による検証とモデルの更新が重要

## 3. 制御性能の評価指標

制御系の「良さ」を定量的に評価するために、様々な評価指標が使われます。

### 安定性（Stability）

**定義**：システムが有界な入力に対して有界な応答を示す性質

制御系の最も基本的な要求であり、安定性が保証されない制御系は使用できません。

**安定性の種類**

1. **BIBO安定（Bounded-Input Bounded-Output Stability）**
   - 有界な入力に対して出力も有界
   - 伝達関数の極がすべて左半平面にある

2. **漸近安定（Asymptotic Stability）**
   - 平衡点からの外乱に対して、時間とともに平衡点に戻る
   - すべての固有値の実部が負

3. **リアプノフ安定（Lyapunov Stability）**
   - より一般的な安定性の定義
   - エネルギー関数的な視点

**安定性の判別法**
- ラウス・フルビッツの安定判別法
- ナイキストの安定判別法
- ボード線図による安定余裕の評価

### 応答速度（Response Speed）

**定義**：制御系が目標値に到達するまでの速さ

**主な指標**

1. **立ち上がり時間（Rise Time）** $t_r$
   - 出力が最終値の10%から90%（または5%から95%）に達するまでの時間
   - 小さいほど応答が速い

2. **整定時間（Settling Time）** $t_s$
   - 出力が最終値の±2%（または±5%）の範囲に収まり、その後も留まる時間
   - 実用的に「制御が完了した」と判断できる時間

3. **ピーク時間（Peak Time）** $t_p$
   - 出力が最初のピーク値に達するまでの時間

4. **帯域幅（Bandwidth）**
   - 制御系が追従できる周波数の範囲
   - 広いほど高速な変化に対応可能

**トレードオフ**
- 応答速度を上げすぎると、オーバーシュートや振動が増加
- ノイズの影響を受けやすくなる

### 定常偏差（Steady-state Error）

**定義**：十分時間が経過した後の目標値と実際の出力の差

$$e_{ss} = \lim_{t \to \infty} [r(t) - y(t)]$$

**定常偏差の種類**

入力信号の種類によって分類：
- **ステップ入力**に対する定常偏差：位置偏差
- **ランプ入力**に対する定常偏差：速度偏差
- **放物線入力**に対する定常偏差：加速度偏差

**定常偏差をゼロにする方法**

1. **積分要素の導入**
   - I制御（積分制御）の追加
   - コントローラに積分器を含める

2. **型（Type）の向上**
   - 開ループ伝達関数に極を追加（原点の極の数を増やす）

3. **フィードフォワード制御の併用**
   - 目標値の情報を直接利用

### ロバスト性（Robustness）

**定義**：モデル誤差や外乱に対する制御性能の頑健性

実際のシステムでは、以下の不確かさが存在します：
- モデル化誤差
- パラメータ変動
- 外乱
- 測定ノイズ

これらの影響に対して、性能が大きく劣化しないことが重要です。

**ロバスト性の評価指標**

1. **ゲイン余裕（Gain Margin, GM）**
   - 閉ループ系が不安定になるまでのゲインの余裕
   - 一般に 6dB 以上が推奨

2. **位相余裕（Phase Margin, PM）**
   - 閉ループ系が不安定になるまでの位相の余裕
   - 一般に 30°〜60° が推奨

3. **感度関数の最大値**
   - モデル誤差や外乱の影響の評価

### 感度関数の概念

**感度関数（Sensitivity Function）** $S(s)$

$$S(s) = \frac{1}{1 + P(s)C(s)}$$

- 外乱やモデル誤差が出力に与える影響を表す
- $|S(j\omega)| < 1$ のとき、外乱が抑制される
- $|S(j\omega)| > 1$ のとき、外乱が増幅される

**相補感度関数（Complementary Sensitivity Function）** $T(s)$

$$T(s) = \frac{P(s)C(s)}{1 + P(s)C(s)} = 1 - S(s)$$

- 目標値追従性能を表す
- $|T(j\omega)| \approx 1$ のとき、目標値に良く追従

**トレードオフ**
- $S(s) + T(s) = 1$ の関係があり、両方を同時に小さくできない
- 低周波：$T \approx 1$, $S \approx 0$（追従性重視）
- 高周波：$T \approx 0$, $S \approx 1$（ノイズ抑制重視）

## 4. 応用例とケーススタディ

ここでは、実際の制御系の具体例を通して、これまで学んだ概念の応用を見ていきます。

### 温度制御システム

**システム概要**
- 対象：恒温槽（一定温度に保つ装置）
- 制御量：槽内の温度 $T(t)$ [℃]
- 操作量：ヒータの電力 $P(t)$ [W]

**ブロック図**

```
設定温度        +         制御入力       熱容量      槽内温度
  T_ref  ──>  ○  ──>  [PID制御]  ──>  [恒温槽]  ──>  T(t)
              -│           C              G           │
               │                                      │
               └───────── [温度センサ] ←──────────────┘
                              H
```

**数学モデル**

熱バランスの式：

$$C_p \frac{dT(t)}{dt} = P(t) - h(T(t) - T_{amb})$$

ここで、
- $C_p$：熱容量 [J/℃]
- $h$：熱伝達係数 [W/℃]
- $T_{amb}$：外気温度 [℃]

**設計考慮点**
- **モデリング**：熱容量と熱損失の推定が重要
- **外乱**：外気温度の変化、扉の開閉
- **制御方式**：PI制御（定常偏差除去）またはPID制御
- **制約**：ヒータ出力の上限、温度のオーバーシュート抑制

**実装例**
- サーモスタット（オン・オフ制御）：単純だが温度変動が大きい
- PID制御：滑らかな温度制御、省エネルギー

### モータ位置制御システム

**システム概要**
- 対象：DCサーボモータ
- 制御量：モータの回転角度 $\theta(t)$ [rad]
- 操作量：モータへの電圧 $V(t)$ [V]

**ブロック図**

```
目標角度       +         制御電圧       DCモータ     回転角度
  θ_ref  ──>  ○  ──>  [PD制御]  ──>  [モータ]  ──>  θ(t)
             -│           C             G           │
              │                                     │
              └──────── [エンコーダ] ←──────────────┘
                             H
```

**数学モデル**

電気系：$L\frac{di}{dt} + Ri = V - K_e\dot{\theta}$

機械系：$J\frac{d^2\theta}{dt^2} + B\frac{d\theta}{dt} = K_t i$

簡略化（電気系の時定数が小さい場合）：

$$J\frac{d^2\theta}{dt^2} + B\frac{d\theta}{dt} = Ku(t)$$

**設計考慮点**
- **モデリング**：慣性モーメント $J$、粘性摩擦係数 $B$ の同定
- **外乱**：負荷トルクの変動、摩擦の変化
- **制御方式**：PD制御（速度減衰）＋I制御（位置偏差除去）
- **制約**：電圧の飽和、速度・加速度の制限

**実装例**
- ロボットアームの関節制御
- プリンタのヘッド位置制御
- 産業用位置決め装置

### 液面レベル制御システム

**システム概要**
- 対象：タンクの液面レベル
- 制御量：液面高さ $h(t)$ [m]
- 操作量：流入流量 $q_{in}(t)$ [m³/s]

**ブロック図**

```
目標レベル     +         制御流量      タンク      液面高さ
  h_ref  ──>  ○  ──>  [PI制御]  ──>  [タンク]  ──>  h(t)
             -│          C            G          │
              │                                  │
              └───── [レベルセンサ] ←─────────────┘
                            H

              外乱 q_out(t) (流出流量)
                    ↓
                  [タンク]
```

**数学モデル**

質量保存則：

$$A\frac{dh(t)}{dt} = q_{in}(t) - q_{out}(t)$$

ここで、
- $A$：タンクの断面積 [m²]
- $q_{out}(t)$：流出流量（外乱）[m³/s]

流出流量がバルブ開度に依存する場合：

$$q_{out}(t) = C_v\sqrt{h(t)}$$

**設計考慮点**
- **モデリング**：タンクの形状、流出特性の非線形性
- **外乱**：流出流量の変動（需要の変化）
- **制御方式**：PI制御（液面レベルの定常偏差除去）
- **制約**：流入流量の上下限、タンク容量の制限

**実装例**
- 上水道の配水池制御
- 化学プラントのバッファタンク
- ボイラーの水位制御

### 各例でのブロック図と設計考慮点のまとめ

| システム | 主な外乱 | 推奨制御方式 | 重要な性能指標 |
|---------|---------|------------|-------------|
| 温度制御 | 外気温変化、熱負荷 | PI/PID制御 | 定常偏差、オーバーシュート |
| モータ位置制御 | 負荷トルク変動 | PID制御、状態FB | 整定時間、位置精度 |
| 液面レベル制御 | 流出流量変動 | PI制御 | 定常偏差、安定性 |

共通の設計プロセス：
1. システムのモデリング（物理法則または実験）
2. 制御仕様の設定（応答速度、精度など）
3. 制御方式の選定（PID、状態FB等）
4. パラメータチューニング（シミュレーション＋実機調整）
5. 外乱応答の検証とロバスト性の確認

## 5. 次章以降への橋渡し

第1章では、制御工学の全体像を理解しました。ここでは、次章以降で学ぶ内容の必要性と重要性を確認します。

### ラプラス変換の必要性

これまで、システムを時間領域の微分方程式で表現してきました：

$$m\frac{d^2x(t)}{dt^2} + b\frac{dx(t)}{dt} + kx(t) = F(t)$$

しかし、微分方程式を直接扱うのは複雑で、制御系の設計や解析が困難です。

**ラプラス変換の利点**

ラプラス変換により、微分方程式を代数方程式に変換できます：

$$ms^2X(s) + bsX(s) + kX(s) = F(s)$$

これにより：
- **代数的操作**が可能になり、計算が簡単に
- **伝達関数**として入出力関係を表現できる
- **周波数応答**の解析が容易に
- **システムの合成**（直列、並列、フィードバック）が簡単に

**第2章で学ぶこと**
- ラプラス変換の定義と基本性質
- 伝達関数の導出と意味
- 基本要素（積分器、1次遅れ、2次系）の伝達関数
- ブロック線図の等価変換

### 伝達関数の導入予告

**伝達関数（Transfer Function）** $G(s)$ は、制御工学の中心的な概念です：

$$G(s) = \frac{Y(s)}{U(s)}$$

これは、「入力 $U(s)$ に対する出力 $Y(s)$ の比」を表します。

**伝達関数でできること**

1. **システムの特性把握**
   - 極と零点からシステムの安定性や応答特性を判定
   - 例：2次系の伝達関数 $G(s) = \frac{\omega_n^2}{s^2 + 2\zeta\omega_n s + \omega_n^2}$
   - $\omega_n$：固有角周波数、$\zeta$：減衰比

2. **閉ループ系の解析**
   - フィードバック結合の伝達関数：
     $$T(s) = \frac{P(s)C(s)}{1 + P(s)C(s)}$$
   - 安定性、応答特性、定常偏差の解析

3. **コントローラ設計**
   - PID制御器の伝達関数：
     $$C(s) = K_p + \frac{K_i}{s} + K_d s$$
   - ゲイン調整による性能改善

**第3章で学ぶこと**
- 伝達関数と微分方程式の対応
- 1次遅れ系、2次系の特性
- ステップ応答、インパルス応答
- 極と零点の配置と応答の関係

### 周波数応答解析の重要性

**周波数応答（Frequency Response）**とは、正弦波入力に対するシステムの応答特性です。

入力：$u(t) = A\sin(\omega t)$

出力：$y(t) = B\sin(\omega t + \phi)$

ここで、
- $B/A$：ゲイン（振幅比）
- $\phi$：位相差

**周波数応答でわかること**

1. **ボード線図（Bode Plot）**
   - ゲイン特性と位相特性を周波数ごとにプロット
   - システムの帯域幅、共振特性が一目でわかる

2. **安定性の判別**
   - ゲイン余裕、位相余裕の評価
   - ナイキスト線図による安定判別

3. **ロバスト性の評価**
   - 感度関数 $S(j\omega)$ の周波数特性
   - 外乱やモデル誤差の影響を周波数ごとに評価

4. **実験による同定**
   - 実システムに正弦波を入力して周波数応答を測定
   - 測定データから伝達関数を推定

**第4章以降で学ぶこと**
- ボード線図の描き方と読み方
- ナイキスト線図と安定判別
- ゲイン余裕・位相余裕の計算
- 周波数応答法によるコントローラ設計

### 学習の展望

制御工学の学習は、以下のように発展していきます：

```
第1章：全体像の理解（現在）
  ↓ フィードバック制御の基本概念
第2章：ラプラス変換
  ↓ 時間領域から周波数領域へ
第3章：伝達関数とシステム応答
  ↓ システムの特性把握
第4章：周波数応答解析
  ↓ 安定性とロバスト性の評価
第5章：古典制御設計（根軌跡法、ボード線図法）
  ↓ PID制御器の体系的設計
第6章：現代制御理論（状態空間法）
  ↓ 多変数系、最適制御
第7章：ディジタル制御
  ↓ 実装への応用
```

**重要なマインドセット**
- 各章の内容は独立しているのではなく、相互に関連している
- 基礎をしっかり理解することで、応用が容易になる
- 理論と実践（シミュレーション、実験）を組み合わせて学ぶ

---

## まとめ

この理解者向け技術ノートでは、制御工学の実践的な側面を学びました：

1. **制御系設計の8ステップ**
   - 目的明確化 → モデリング → 仕様設定 → 方式選定 → 設計 → シミュレーション → 実装 → 評価改善
   - 体系的なアプローチにより、確実に制御系を構築できる

2. **モデリングの重要性**
   - 物理モデルと数学モデルの関係
   - 伝達関数表現と状態空間表現
   - 精度とトレードオフのバランス

3. **制御性能の評価指標**
   - 安定性：最も基本的な要求
   - 応答速度：立ち上がり時間、整定時間
   - 定常偏差：目標値との最終誤差
   - ロバスト性：不確かさへの頑健性
   - 感度関数：外乱やモデル誤差の影響評価

4. **応用例とケーススタディ**
   - 温度制御、モータ位置制御、液面レベル制御
   - 各システムの特性と設計考慮点
   - ブロック図による構造の理解

5. **次章への橋渡し**
   - ラプラス変換による解析の簡略化
   - 伝達関数の導入
   - 周波数応答解析の重要性

これで第1章の学習は完了です。次章では、ラプラス変換を用いた制御系の解析手法を学び、より高度な制御系設計への道を歩んでいきます。

**次のステップ**
- 第2章「ラプラス変換」で数学的基礎を固める
- インタラクティブシミュレータで直感的理解を深める
- 実際のシステムへの適用を考えながら学習を進める

制御工学は理論と実践が融合した学問です。理論を学び、シミュレーションで検証し、実システムで確認するというサイクルを通じて、確実にスキルを身につけていきましょう。
