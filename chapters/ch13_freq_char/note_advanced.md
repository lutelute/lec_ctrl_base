# 第13章 制御系の周波数特性 - 理解者編

## 1. ナイキストの安定判別法 (Nyquist Stability Criterion)

### 1.1 安定判別法の理論的基礎

**ナイキストの安定判別法 (Nyquist stability criterion)** は、開ループ伝達関数 $G(s)H(s)$ の周波数応答から、閉ループ系の安定性を厳密に判定する手法です。

**閉ループ伝達関数**:
$$T(s) = \frac{G(s)}{1 + G(s)H(s)}$$

ここで、$G(s)$ はプラント、$H(s)$ はフィードバック要素の伝達関数です。

**特性方程式**:
$$1 + G(s)H(s) = 0$$

閉ループ系の極は、特性方程式の根（零点）です。系が安定であるためには、すべての極が複素平面の左半平面（Re[$s$] < 0）に存在する必要があります。

### 1.2 偏角の原理 (Argument Principle)

ナイキストの安定判別法は、複素関数論の**偏角の原理**に基づいています。

**偏角の原理**: 複素関数 $F(s)$ が閉曲線 $\Gamma$ に沿って解析的であるとき、$\Gamma$ を $s$ が1周したときに $F(s)$ 平面での軌跡が原点を囲む回数 $N$ は：

$$N = Z - P$$

ここで：
- $Z$ : $\Gamma$ 内部にある $F(s)$ の零点の数
- $P$ : $\Gamma$ 内部にある $F(s)$ の極の数
- $N$ : 原点を囲む回数（反時計回りを正）

**適用**: 特性方程式 $F(s) = 1 + G(s)H(s)$ に対して：
- $Z$ : 閉ループ系の右半平面極の数（不安定極）
- $P$ : 開ループ系 $G(s)H(s)$ の右半平面極の数

安定性の条件は $Z = 0$ なので：
$$N = -P$$

すなわち、ナイキスト軌跡が点 $(-1, 0)$ を $P$ 回、**時計回り**に囲む必要があります。

> **重要**: 開ループ系が安定（$P = 0$）なら、ナイキスト軌跡が $(-1, 0)$ を囲まなければ閉ループも安定です。これが最も一般的なケースです。

### 1.3 ナイキスト経路 (Nyquist Path)

**標準ナイキスト経路**: 複素平面の右半平面全体を囲む経路

1. **虚軸**: $s = j\omega$、$\omega: 0 \to +\infty$
2. **無限大の半円**: $s = Re^{j\theta}$、$R \to \infty$、$\theta: \pi/2 \to -\pi/2$
3. **虚軸の戻り**: $s = j\omega$、$\omega: -\infty \to 0$

**実用的簡略化**:
- 軌跡は実軸に対して対称なので、$\omega: 0 \to +\infty$ のみ描く
- 多くの場合、無限大の半円は原点に写像される

### 1.4 安定判別の実際的手順

**ステップ1**: 開ループ伝達関数 $G(s)H(s)$ の右半平面極の数 $P$ を数える

**ステップ2**: ナイキスト軌跡（$\omega: 0 \to \infty$ での $G(j\omega)H(j\omega)$）を描く

**ステップ3**: 軌跡が点 $(-1, 0)$ を囲む回数 $N$ を数える（反時計回りを正）

**ステップ4**: 閉ループの右半平面極の数 $Z = N + P$ を計算

**ステップ5**: $Z = 0$ なら安定、$Z > 0$ なら不安定

**例題1**: $G(s) = \frac{K}{s(s+1)(s+2)}$、$H(s) = 1$ の閉ループ安定性を判定せよ。

**解**:

**ステップ1**: 開ループの極: $s = 0, -1, -2$ （すべて左半平面または虚軸上）
$$P = 0$$

**ステップ2**: 周波数応答
$$G(j\omega) = \frac{K}{j\omega(j\omega+1)(j\omega+2)} = \frac{K}{j\omega(1 + j\omega)(2 + j\omega)}$$

振幅:
$$|G(j\omega)| = \frac{K}{\omega\sqrt{1+\omega^2}\sqrt{4+\omega^2}}$$

位相:
$$\arg(G(j\omega)) = -90° - \arctan(\omega) - \arctan(\omega/2)$$

**ステップ3**:
- $\omega \to 0$: $|G(j\omega)| \to \infty$、$\arg \to -90°$
- $\omega \to \infty$: $|G(j\omega)| \to 0$、$\arg \to -270°$

位相が -180° となる周波数で実軸と交差:
$$-90° - \arctan(\omega_{pc}) - \arctan(\omega_{pc}/2) = -180°$$

これを解くと $\omega_{pc} = \sqrt{2}$ rad/s

このとき、$|G(j\sqrt{2})| = \frac{K}{\sqrt{2} \cdot \sqrt{3} \cdot \sqrt{6}} = \frac{K}{6}$

**ステップ4**:
- $K < 6$ のとき: 軌跡は $(-1, 0)$ より右側を通過 → $N = 0$
- $K = 6$ のとき: 軌跡は $(-1, 0)$ を通過 → 臨界安定
- $K > 6$ のとき: 軌跡は $(-1, 0)$ を囲む → $N = -2$（時計回り）

**ステップ5**:
- $K < 6$: $Z = N + P = 0 + 0 = 0$ → **安定**
- $K > 6$: $Z = N + P = -2 + 0 = -2$ → **不安定**

> **結論**: この系は $K < 6$ で安定です。これはゲイン余裕の概念と一致します。

### 1.5 特殊なケースの扱い

**ケース1: 原点に極がある場合（積分器を含む系）**

$G(s) = \frac{K}{s^n(\cdots)}$ の場合、$\omega \to 0$ で $|G(j\omega)| \to \infty$ となります。

**処理方法**: 虚軸上の原点周りを小さな半円で迂回する
- 半円: $s = \epsilon e^{j\theta}$、$\theta: \pi/2 \to -\pi/2$、$\epsilon \to 0$
- 写像: $G(s) \approx \frac{K}{(\epsilon e^{j\theta})^n} = \frac{K}{\epsilon^n}e^{-jn\theta}$
- 軌跡: 無限大の半円を $n \times 180°$ だけ時計回り

**ケース2: 虚軸上に極がある場合**

$G(s)$ が $s = \pm j\omega_0$ に極を持つ場合、ナイキスト経路はその点を小さな半円で迂回します。これは系が不安定であることを示唆します。

**ケース3: むだ時間を含む場合**

伝達関数が $G(s) = G_0(s)e^{-Ls}$ の形の場合：

$$G(j\omega) = G_0(j\omega)e^{-j\omega L}$$

位相が $-\omega L$ [rad] だけ追加され、高周波で位相が無限に遅れます。

## 2. 複雑なシステムの周波数解析 (Frequency Analysis of Complex Systems)

### 2.1 多重ループ系の解析

**多重ループ系**: 複数のフィードバックループを持つ制御系

**内側ループから順次解析する方法**:

システム構成:
$$G_1(s) \to \text{内側ループ} \to G_2(s) \to \text{外側ループ}$$

**ステップ1**: 内側ループの等価伝達関数を求める
$$G_{inner}(s) = \frac{G_1(s)}{1 + G_1(s)H_1(s)}$$

**ステップ2**: 外側ループの開ループ伝達関数
$$G_{outer}(s) = G_{inner}(s) \cdot G_2(s)$$

**ステップ3**: 外側ループの安定性を判定
$$T(s) = \frac{G_{outer}(s)}{1 + G_{outer}(s)H_2(s)}$$

**例題2**: 以下の多重ループ系の安定性を解析せよ。

内側ループ: $G_1(s) = \frac{10}{s+1}$、$H_1(s) = 1$

外側ループ: $G_2(s) = \frac{1}{s+2}$、$H_2(s) = K$

**解**:

**内側ループの等価伝達関数**:
$$G_{inner}(s) = \frac{10/(s+1)}{1 + 10/(s+1)} = \frac{10}{s+11}$$

**外側ループの開ループ伝達関数**:
$$G_{outer}(s) = \frac{10}{s+11} \cdot \frac{K}{s+2} = \frac{10K}{(s+11)(s+2)}$$

**ナイキスト判別**:
開ループは安定（すべての極が左半平面）なので $P = 0$

周波数応答:
$$|G_{outer}(j\omega)| = \frac{10K}{\sqrt{\omega^2+121}\sqrt{\omega^2+4}}$$

この系は常に安定（$N = 0$）、任意の $K > 0$ で安定です。

### 2.2 非最小位相系 (Non-Minimum Phase Systems)

**非最小位相系**: 右半平面に零点を持つ系

**伝達関数の例**:
$$G(s) = \frac{1 - Ts}{1 + Ts} \quad (T > 0)$$

**特徴**:
- ゲイン特性は通常の系と同じ
- 位相特性が異常（位相が通常より遅れる）

**周波数応答**:
$$G(j\omega) = \frac{1 - j\omega T}{1 + j\omega T}$$

振幅:
$$|G(j\omega)| = \frac{\sqrt{1 + \omega^2T^2}}{\sqrt{1 + \omega^2T^2}} = 1$$

位相:
$$\arg(G(j\omega)) = -\arctan(\omega T) - \arctan(\omega T) = -2\arctan(\omega T)$$

**ボード線図の特徴**:
- ゲイン線図: すべての周波数で 0 dB（フラット）
- 位相線図: 0° から -180° まで遅れる（通常の1次遅れの2倍）

> **注意**: 非最小位相系は、同じゲイン特性を持つ最小位相系よりも位相が遅れるため、安定性余裕が小さくなります。

**物理的な例**:
- ロケットのジンバル制御（推力方向制御）
- 化学プロセスの一部（逆応答を示す系）

### 2.3 高次システムの周波数特性

**高次伝達関数の標準形**:
$$G(s) = K \frac{\prod_{i=1}^{m}(s + z_i)}{\prod_{j=1}^{n}(s + p_j)}$$

ここで、$n > m$（プロパーな系）。

**ボード線図の合成規則**:

**ゲイン線図** [dB]:
$$20\log_{10}|G(j\omega)| = 20\log_{10}K + \sum_{i=1}^{m}20\log_{10}|j\omega + z_i| - \sum_{j=1}^{n}20\log_{10}|j\omega + p_j|$$

**位相線図** [deg]:
$$\arg(G(j\omega)) = \sum_{i=1}^{m}\arg(j\omega + z_i) - \sum_{j=1}^{n}\arg(j\omega + p_j)$$

**漸近線近似の手順**:

1. すべての極と零点を周波数順にソート
2. 低周波から順に、各折点周波数で傾きを変更
   - 極: 傾き -20 dB/decade を追加
   - 零点: 傾き +20 dB/decade を追加
3. 位相は各極・零点の寄与を加算

**例題3**: 以下の伝達関数のボード線図を描け。
$$G(s) = \frac{1000(s+10)}{s(s+1)(s+100)}$$

**解**:

**要素の分解**:
- ゲイン: $K = 1000$
- 零点: $z_1 = -10$（折点周波数 $\omega_{z1} = 10$ rad/s）
- 極: $p_1 = 0$（積分器）、$p_2 = -1$（$\omega_{p2} = 1$ rad/s）、$p_3 = -100$（$\omega_{p3} = 100$ rad/s）

**低周波ゲイン**（$\omega = 1$ rad/s）:
$$|G(j1)| = \frac{1000 \times \sqrt{1+100}}{1 \times \sqrt{1+1} \times \sqrt{1+10000}} \approx \frac{1000 \times 10}{1 \times 1.41 \times 100} \approx 70.9$$

$$20\log_{10}(70.9) \approx 37 \text{ dB}$$

**ゲイン線図の漸近線**:
- $\omega < 1$: 傾き -20 dB/decade（積分器）
- $1 < \omega < 10$: 傾き -40 dB/decade（極 $p_2$ が追加）
- $10 < \omega < 100$: 傾き -20 dB/decade（零点 $z_1$ で +20 dB/decade）
- $\omega > 100$: 傾き -40 dB/decade（極 $p_3$ が追加）

**位相線図**:
$$\arg(G(j\omega)) = -90° + \arctan(\omega/10) - \arctan(\omega) - \arctan(\omega/100)$$

低周波: $-90°$

高周波: $-90° + 90° - 90° - 90° = -180°$

## 3. ロバスト安定性 (Robust Stability)

### 3.1 モデル化誤差と不確かさ

実際の制御系では、プラントのモデル $G(s)$ は真のシステムと完全には一致しません。

**モデル化誤差の表現**:

真のシステム: $G_{true}(s)$

ノミナルモデル: $G_{nom}(s)$

**加法的不確かさ (additive uncertainty)**:
$$G_{true}(s) = G_{nom}(s) + \Delta_a(s)$$

**乗法的不確かさ (multiplicative uncertainty)**:
$$G_{true}(s) = G_{nom}(s)(1 + \Delta_m(s))$$

ここで、$\Delta_a(s)$ や $\Delta_m(s)$ は未知の不確かさを表します。

**不確かさの境界**: 通常、周波数ごとの大きさで制約されます。
$$|\Delta_m(j\omega)| \leq W(j\omega)$$

ここで、$W(j\omega)$ は**重み関数**で、周波数に応じた不確かさの上限を表します。

### 3.2 ロバスト安定性の条件

**問題設定**: すべての許容される不確かさ $\Delta_m(s)$ に対して、閉ループ系が安定であるための条件は？

**乗法的不確かさに対するロバスト安定性条件**:

閉ループ系 $\frac{G_{nom}(s)(1 + \Delta_m(s))}{1 + G_{nom}(s)(1 + \Delta_m(s))}$ がすべての $|\Delta_m(j\omega)| \leq W(j\omega)$ に対して安定である条件は：

$$|W(j\omega)T(j\omega)| < 1 \quad \forall \omega$$

ここで、$T(s) = \frac{G_{nom}(s)}{1 + G_{nom}(s)}$ は**相補感度関数 (complementary sensitivity function)** です。

**感度関数 (sensitivity function)**:
$$S(s) = \frac{1}{1 + G(s)}$$

これは外乱抑制性能を表します。

**関係式**:
$$S(s) + T(s) = 1$$

### 3.3 安定性余裕とロバスト性の関係

**ゲイン余裕とロバスト性**:

ゲイン余裕 GM [dB] は、ゲインの不確かさに対する安定性の余裕を表します：
$$\frac{1}{1 + \text{GM}_{\text{linear}}} < |G(j\omega)| < 1 + \text{GM}_{\text{linear}}$$

**位相余裕とロバスト性**:

位相余裕 PM [deg] は、位相の不確かさに対する安定性の余裕を表します：
$$|\arg(G(j\omega)) - \text{PM}| < 180°$$

**ベクトル余裕 (vector margin)** はより包括的なロバスト性指標:
$$\text{VM} = \min_{\omega}|1 + G(j\omega)|$$

ベクトル余裕 $r$ に対して：
- ゲイン不確かさ: $(1-r, 1+r)$ の範囲
- 位相不確かさ: $\pm \arcsin(r)$ の範囲

で安定性が保証されます。

**例題4**: $G(s) = \frac{10}{s(s+1)(s+5)}$ のベクトル余裕を求めよ。

**解**:

周波数応答:
$$G(j\omega) = \frac{10}{j\omega(j\omega+1)(j\omega+5)}$$

$1 + G(j\omega)$ の最小値を求める必要があります。これは数値計算で：

$$\text{VM} = \min_{\omega}|1 + G(j\omega)| \approx 0.38$$

これより：
- ゲイン変動許容範囲: $0.62 \sim 1.38$ （約 $\pm 38\%$）
- 位相変動許容範囲: $\pm 22°$

### 3.4 $H_{\infty}$ 制御の基礎

**$H_{\infty}$ ノルム**: 周波数応答の最大ゲイン
$$\|G(s)\|_{\infty} = \max_{\omega}|G(j\omega)|$$

**ロバスト安定性条件の再表現**:
$$\|W(s)T(s)\|_{\infty} < 1$$

**混合感度問題 (mixed sensitivity problem)**:

設計仕様を複数の周波数重み関数で表現：
$$\left\| \begin{bmatrix} W_S(s)S(s) \\ W_T(s)T(s) \end{bmatrix} \right\|_{\infty} < 1$$

ここで：
- $W_S(s)$: 感度関数の重み（外乱抑制性能の仕様）
- $W_T(s)$: 相補感度関数の重み（ロバスト性の仕様）

**設計のトレードオフ**:

$S(s) + T(s) = 1$ より、両方を同時に小さくすることはできません：
- 低周波: $|S(j\omega)|$ を小さく → 外乱抑制
- 高周波: $|T(j\omega)|$ を小さく → ロバスト性、ノイズ抑制
- 中周波: $|S(j\omega)|$ と $|T(j\omega)|$ のバランス

> **注意**: $H_{\infty}$ 制御の詳細は制御理論の発展的なトピックです。ここでは周波数特性と安定性余裕の関係の延長として理解することが重要です。

## 4. 実システムにおける周波数解析の応用 (Applications in Real Systems)

### 4.1 周波数応答の実測

**実験的周波数応答同定**:

1. **正弦波掃引法 (sine sweep)**:
   - 各周波数で正弦波を入力
   - 定常状態での出力の振幅比と位相差を測定

2. **周波数応答アナライザ (FRA)**:
   - FFTを用いた高速測定
   - ノイズ下でも精度良く測定可能

3. **PRBSによる同定**:
   - 疑似ランダム信号を入力
   - FFTで入出力のスペクトルから周波数応答を計算

**測定データからの伝達関数同定**:
- ボード線図から極・零点を推定
- 最小二乗法によるパラメータフィッティング

### 4.2 周波数領域での制御器調整

**ループシェーピング (loop shaping)**: ボード線図の形状を直接設計する手法

**設計指針**:

1. **低周波領域**（$\omega < \omega_{gc}$）:
   - ゲインを高く → 定常偏差の抑制
   - 傾き -20 dB/decade → 1型サーボ（積分特性）

2. **ゲイン交差周波数付近**（$\omega \approx \omega_{gc}$）:
   - 傾き -20 dB/decade → 良好な位相余裕
   - PM = 45° 〜 60° → 適度な減衰

3. **高周波領域**（$\omega > \omega_{gc}$）:
   - ゲインを急激に減衰 → ノイズ抑制
   - 傾き -40 dB/decade 以上が望ましい

**例題5**: プラント $G(s) = \frac{1}{s(s+1)}$ に対して、PM ≥ 50° を達成する比例ゲイン $K$ を求めよ。

**解**:

制御器: $C(s) = K$

開ループ: $L(s) = KG(s) = \frac{K}{s(s+1)}$

周波数応答:
$$L(j\omega) = \frac{K}{j\omega(j\omega+1)}$$

位相:
$$\arg(L(j\omega)) = -90° - \arctan(\omega)$$

ゲイン交差周波数 $\omega_{gc}$ で $|L(j\omega_{gc})| = 1$:
$$\frac{K}{\omega_{gc}\sqrt{1+\omega_{gc}^2}} = 1$$

位相余裕:
$$\text{PM} = 180° - 90° - \arctan(\omega_{gc}) = 90° - \arctan(\omega_{gc})$$

PM = 50° の条件:
$$90° - \arctan(\omega_{gc}) = 50°$$

$$\arctan(\omega_{gc}) = 40°$$

$$\omega_{gc} = \tan(40°) \approx 0.839 \text{ rad/s}$$

ゲイン:
$$K = \omega_{gc}\sqrt{1+\omega_{gc}^2} = 0.839 \times \sqrt{1+0.704} \approx 1.10$$

**結論**: $K = 1.10$ で PM ≈ 50° が達成されます。

### 4.3 実践的な設計例

**設計仕様**:
- 定常偏差: ステップ入力に対して 0
- 整定時間: 2秒以内
- オーバーシュート: 20% 以下
- ゲイン余裕: ≥ 8 dB
- 位相余裕: ≥ 45°

**プラント**: $G(s) = \frac{1}{(s+1)(s+2)}$

**設計手順**:

**ステップ1**: オーバーシュート 20% → 減衰比 $\zeta \approx 0.45$

位相余裕の目標: PM ≈ 45°

**ステップ2**: 整定時間 2秒 → 帯域幅（ゲイン交差周波数）$\omega_{gc} \approx 2$ rad/s

**ステップ3**: 定常偏差 0 → 積分器が必要

制御器: $C(s) = K_p + \frac{K_i}{s}$

**ステップ4**: 開ループ伝達関数
$$L(s) = C(s)G(s) = \left(K_p + \frac{K_i}{s}\right) \frac{1}{(s+1)(s+2)}$$

**ステップ5**: ボード線図を描いて $K_p$、$K_i$ を調整

試行: $K_p = 8$、$K_i = 4$

$$L(s) = \frac{8s + 4}{s(s+1)(s+2)} = \frac{8(s + 0.5)}{s(s+1)(s+2)}$$

**ステップ6**: 周波数応答を計算して仕様を確認

（数値計算により）GM ≈ 10 dB、PM ≈ 48° → 仕様を満たす

---

## まとめ

この理解者編では、以下を学びました：

- ナイキストの安定判別法の理論的基礎と偏角の原理
- ナイキスト経路の定義と安定判別の厳密な手順
- 原点に極がある場合や非最小位相系などの特殊ケースの扱い
- 多重ループ系や高次システムの周波数解析手法
- ボード線図の合成規則と漸近線近似による複雑なシステムの解析
- モデル化誤差と不確かさの表現（加法的・乗法的不確かさ）
- ロバスト安定性の条件と安定性余裕（ゲイン余裕、位相余裕、ベクトル余裕）の関係
- 感度関数と相補感度関数を用いたロバスト性評価
- $H_{\infty}$ 制御の基本概念と混合感度問題
- 実システムにおける周波数応答の実測法とループシェーピングによる制御器設計

周波数特性解析は、制御系の設計と解析において極めて強力なツールです。ボード線図とナイキスト線図を通じて、システムの安定性、性能、ロバスト性を包括的に評価できます。これらの手法は、古典制御理論の集大成であると同時に、現代制御理論へとつながる基礎となっています。

次章以降では、これらの周波数特性の知識を活用して、PID制御器の設計や補償器の設計について学習します。
