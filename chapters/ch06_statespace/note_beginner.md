# 第6章 状態空間表現 - 初級編

## 1. はじめに (Introduction)

**状態空間表現 (State-Space Representation)** は、制御工学における現代的なシステム記述方法です。これまで学んだ伝達関数表現が入力と出力の関係を表現するのに対し、状態空間表現はシステムの**内部状態**を明示的に扱うことができます。

この初級編では、状態空間表現の基本概念を直感的に理解し、簡単な例を通じて数式の意味を学びます。

---

## 2. 状態変数とは何か (State Variables)

### 2.1 直感的理解

**状態変数 (state variables)** とは、システムの「今の様子」を完全に記述するために必要な最小限の情報のことです。

**例**: バネで吊るされた質量のシステムを考えます。
- このシステムの「今の様子」を知るには、**位置**と**速度**の2つの情報が必要です
- これらの情報があれば、未来のシステムの動きを予測できます
- これらの情報（位置と速度）が**状態変数**です

### 2.2 状態ベクトル

複数の状態変数をまとめて**状態ベクトル**と呼びます。$n$個の状態変数を持つシステムでは：

$$
\mathbf{x}(t) = \begin{bmatrix} x_1(t) \\ x_2(t) \\ \vdots \\ x_n(t) \end{bmatrix}
$$

ここで、$\mathbf{x}(t)$は時刻$t$におけるシステムの状態を表します。

> **注意**: 状態変数の数$n$をシステムの**次数 (order)** または**次元 (dimension)** と呼びます。

---

## 3. 状態方程式 (State Equation)

### 3.1 状態方程式の形

状態空間表現の核となる式が**状態方程式**です：

$$
\dot{\mathbf{x}}(t) = \mathbf{A}\mathbf{x}(t) + \mathbf{B}\mathbf{u}(t)
$$

**各項の意味**:
- $\dot{\mathbf{x}}(t)$: 状態の時間微分（状態の変化率）
- $\mathbf{x}(t)$: 現在の状態ベクトル
- $\mathbf{u}(t)$: 入力ベクトル（制御信号や外乱）
- $\mathbf{A}$: システム行列（$n \times n$）- システムの内部的な動きを表す
- $\mathbf{B}$: 入力行列（$n \times m$）- 入力が状態にどう影響するかを表す

### 3.2 直感的な解釈

この式は次のことを表しています：

**「状態がどう変化するか」= 「現在の状態の影響」+ 「入力の影響」**

つまり、システムの未来の動きは、「今の状態」と「与える入力」によって決まります。

---

## 4. 出力方程式 (Output Equation)

### 4.1 出力方程式の形

**出力方程式**は、内部状態から観測可能な出力を計算する式です：

$$
\mathbf{y}(t) = \mathbf{C}\mathbf{x}(t) + \mathbf{D}\mathbf{u}(t)
$$

**各項の意味**:
- $\mathbf{y}(t)$: 出力ベクトル（観測できる量）
- $\mathbf{C}$: 出力行列（$p \times n$）- どの状態を観測するかを表す
- $\mathbf{D}$: 直達項（$p \times m$）- 入力が出力に直接影響する項（多くの場合ゼロ）

### 4.2 直感的な解釈

多くの実システムでは、内部状態を直接観測できません。例えば：
- 電気回路では、電流は測れても内部のキャパシタ電圧は測れないかもしれません
- 機械システムでは、位置は測れても速度センサーがないかもしれません

出力方程式は、「測定できる量」と「内部状態」の関係を表します。

---

## 5. 状態空間表現のまとめ

状態方程式と出力方程式を合わせて**状態空間表現**と呼びます：

$$
\begin{aligned}
\dot{\mathbf{x}}(t) &= \mathbf{A}\mathbf{x}(t) + \mathbf{B}\mathbf{u}(t) \\
\mathbf{y}(t) &= \mathbf{C}\mathbf{x}(t) + \mathbf{D}\mathbf{u}(t)
\end{aligned}
$$

または、行列$\{\mathbf{A}, \mathbf{B}, \mathbf{C}, \mathbf{D}\}$の組で表現されます。

---

## 6. 1次系の例：RC回路 (First-Order System: RC Circuit)

### 6.1 システムの説明

抵抗$R$とキャパシタ$C$からなる単純なRC回路を考えます。

```
    R
 ──┬─╱╱╱╱─┬───
u(t)    C     y(t)
 ───────┴───────
```

- 入力: 電圧$u(t)$
- 出力: キャパシタの電圧$y(t) = v_C(t)$
- 状態変数: キャパシタの電圧$x(t) = v_C(t)$

### 6.2 状態空間表現の導出

キルヒホッフの法則より：

$$
RC\frac{dv_C}{dt} + v_C = u(t)
$$

これを整理すると：

$$
\frac{dv_C}{dt} = -\frac{1}{RC}v_C + \frac{1}{RC}u(t)
$$

状態変数$x = v_C$として状態方程式：

$$
\dot{x}(t) = -\frac{1}{RC}x(t) + \frac{1}{RC}u(t)
$$

出力方程式（キャパシタ電圧を直接測定）：

$$
y(t) = x(t)
$$

### 6.3 行列表現

$$
\begin{aligned}
\dot{x}(t) &= \left[-\frac{1}{RC}\right]x(t) + \left[\frac{1}{RC}\right]u(t) \\
y(t) &= [1]x(t) + [0]u(t)
\end{aligned}
$$

したがって：
- $A = -\frac{1}{RC}$ （スカラー）
- $B = \frac{1}{RC}$ （スカラー）
- $C = 1$ （スカラー）
- $D = 0$ （スカラー）

> **注意**: 1次系では行列は1×1、つまりスカラーになります。

---

## 7. 2次系の例：バネ-マス-ダンパ系 (Second-Order System: Spring-Mass-Damper)

### 7.1 システムの説明

質量$m$、バネ定数$k$、減衰係数$c$のバネ-マス-ダンパ系を考えます。

```
    ┌───┐
    │ m │ ← 質量
    └───┘
     ║ ║  ← バネ(k)
     ╠═╣  ← ダンパ(c)
     ║ ║
   ───────
```

- 入力: 外力$u(t) = f(t)$
- 出力: 位置$y(t)$
- 状態変数: 位置$x_1(t)$と速度$x_2(t)$

### 7.2 状態空間表現の導出

運動方程式：

$$
m\ddot{y} + c\dot{y} + ky = f(t)
$$

状態変数を定義：
- $x_1(t) = y(t)$ （位置）
- $x_2(t) = \dot{y}(t)$ （速度）

これらの微分は：

$$
\begin{aligned}
\dot{x}_1(t) &= x_2(t) \\
\dot{x}_2(t) &= \ddot{y}(t) = -\frac{k}{m}x_1(t) - \frac{c}{m}x_2(t) + \frac{1}{m}u(t)
\end{aligned}
$$

### 7.3 行列表現

状態方程式：

$$
\begin{bmatrix} \dot{x}_1(t) \\ \dot{x}_2(t) \end{bmatrix}
= \begin{bmatrix} 0 & 1 \\ -\frac{k}{m} & -\frac{c}{m} \end{bmatrix}
\begin{bmatrix} x_1(t) \\ x_2(t) \end{bmatrix}
+ \begin{bmatrix} 0 \\ \frac{1}{m} \end{bmatrix} u(t)
$$

出力方程式（位置を測定）：

$$
y(t) = \begin{bmatrix} 1 & 0 \end{bmatrix} \begin{bmatrix} x_1(t) \\ x_2(t) \end{bmatrix}
$$

したがって：

$$
\mathbf{A} = \begin{bmatrix} 0 & 1 \\ -\frac{k}{m} & -\frac{c}{m} \end{bmatrix}, \quad
\mathbf{B} = \begin{bmatrix} 0 \\ \frac{1}{m} \end{bmatrix}, \quad
\mathbf{C} = \begin{bmatrix} 1 & 0 \end{bmatrix}, \quad
\mathbf{D} = [0]
$$

### 7.4 数値例

$m = 1$ kg, $k = 4$ N/m, $c = 2$ N·s/m の場合：

$$
\mathbf{A} = \begin{bmatrix} 0 & 1 \\ -4 & -2 \end{bmatrix}, \quad
\mathbf{B} = \begin{bmatrix} 0 \\ 1 \end{bmatrix}, \quad
\mathbf{C} = \begin{bmatrix} 1 & 0 \end{bmatrix}, \quad
\mathbf{D} = [0]
$$

---

## 8. 伝達関数表現との比較 (Comparison with Transfer Function)

### 8.1 伝達関数表現

これまで学んだ**伝達関数**は、ラプラス変換を使って入力$U(s)$と出力$Y(s)$の関係を表します：

$$
G(s) = \frac{Y(s)}{U(s)}
$$

### 8.2 状態空間表現との違い

| 項目 | 伝達関数表現 | 状態空間表現 |
|------|------------|------------|
| 記述するもの | 入出力の関係のみ | システムの内部状態も含む |
| 適用範囲 | 単入力単出力（SISO）が基本 | 多入力多出力（MIMO）も自然に扱える |
| 初期条件 | 扱いにくい（ゼロ初期条件が前提） | 容易に扱える |
| 非線形システム | 扱えない | 拡張可能（状態方程式を非線形にする） |
| 数値計算 | 間接的 | 直接的（コンピュータでの実装が容易） |

### 8.3 変換の可能性

実は、状態空間表現と伝達関数表現は**相互に変換可能**です。単入力単出力（SISO）システムの場合、状態空間表現$\{\mathbf{A}, \mathbf{B}, \mathbf{C}, \mathbf{D}\}$から伝達関数$G(s)$を求める公式があります：

$$
G(s) = \mathbf{C}(s\mathbf{I} - \mathbf{A})^{-1}\mathbf{B} + \mathbf{D}
$$

この式の詳細な導出は中級編で学びます。

---

## 9. 状態空間表現の利点 (Advantages of State-Space Representation)

状態空間表現には多くの利点があります：

1. **内部状態の可視化**: システム内部で何が起きているかを明示的に表現できる
2. **MIMO対応**: 複数の入力と出力を自然に扱える
3. **初期条件の扱い**: 初期状態$\mathbf{x}(0)$を明示的に設定できる
4. **現代制御理論**: 最適制御、状態フィードバック、オブザーバ設計などに不可欠
5. **数値シミュレーション**: 微分方程式として直接数値計算できる
6. **非線形への拡張**: 状態方程式を非線形にすることで非線形システムも扱える

---

## まとめ (Summary)

この初級編では、以下を学びました：

- **状態変数**: システムの「今の様子」を完全に記述する最小限の情報
- **状態方程式**: $\dot{\mathbf{x}} = \mathbf{A}\mathbf{x} + \mathbf{B}\mathbf{u}$ - 状態の時間変化を記述
- **出力方程式**: $\mathbf{y} = \mathbf{C}\mathbf{x} + \mathbf{D}\mathbf{u}$ - 観測可能な出力を記述
- **1次系の例**: RC回路を状態空間表現で記述
- **2次系の例**: バネ-マス-ダンパ系を状態空間表現で記述（位置と速度の2つの状態変数）
- **伝達関数との違い**: 状態空間表現は内部状態を扱え、MIMOシステムにも対応

次の**中級編**では、状態遷移行列$\Phi(t) = e^{\mathbf{A}t}$を学び、状態方程式の解を求める方法、および状態空間表現と伝達関数の関係について詳しく学習します。また、可制御性・可観測性という重要な概念についても触れます。

---

**学習のポイント**:
- 状態変数は「システムの記憶」を表す
- 状態方程式は「未来の予測式」である
- 物理システムから状態空間表現を導出する練習が重要
- 次数（状態変数の数）は必要な微分方程式の次数に対応する

次のステップとして、インタラクティブツールで実際に状態空間表現を試してみましょう！
