# エッジケーステスト実行ガイド

このガイドでは、実装したエッジケース処理を手動でテストする方法を説明します。

## テスト環境の準備

1. ブラウザで `index.html` を開く
2. ブラウザの開発者ツール（F12）を開き、コンソールタブを確認
3. JavaScriptエラーがないことを確認

---

## テストケース 1: 特異行列（Singular Matrix）

### 目的
行列式が0の行列で計算を実行し、警告が表示されることを確認

### 手順
1. **タブ1: 状態方程式入力**に移動
2. 状態数を2に設定
3. A行列を以下のように入力:
   ```
   1    2
   2    4
   ```
   （det(A) = 1×4 - 2×2 = 0）

4. **タブ2: 状態遷移行列計算**に移動
5. 時刻 t = 1 を入力
6. 「Φ(t) を計算」ボタンをクリック

### 期待される結果
- ⚠️ 警告メッセージが表示される
- 「A行列は特異行列またはほぼ特異です（det(A) ≈ 0）。計算結果の精度に注意してください。」

7. **タブ5: 固有値解析**に移動
8. 「固有値解析を実行」ボタンをクリック

### 期待される結果
- ⚠️ 警告メッセージが表示される
- 「A行列は特異行列またはほぼ特異です（det(A) ≈ 0）。少なくとも1つの固有値が0です。」
- 固有値に0または0に近い値が含まれる

---

## テストケース 2: 不安定システム（Unstable System）

### 目的
正の固有値を持つシステムで警告が表示されることを確認

### 手順
1. **タブ1: 状態方程式入力**に移動
2. 状態数を2に設定
3. A行列を以下のように入力:
   ```
   1    0
   0    2
   ```
   （固有値: λ₁ = 1, λ₂ = 2、両方とも正）

4. **タブ3: 時間応答シミュレーション**に移動
5. 初期状態 x₁(0) = 1, x₂(0) = 1
6. 入力タイプ: ゼロ入力
7. シミュレーション時間: 5秒
8. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- ⚠️ 警告メッセージが表示される
- 「システムは不安定です（正の実部を持つ固有値が存在）。応答が発散する可能性があります。」
- グラフで状態変数が時間とともに増加（発散）する様子が表示される

9. **タブ5: 固有値解析**に移動
10. 「固有値解析を実行」ボタンをクリック

### 期待される結果
- ✗ 「システムは**不安定**です（正の実部を持つ固有値が存在）」と表示
- s平面プロットで固有値が右半平面（実部 > 0）に表示される
- 虚軸が赤い破線で表示される

---

## テストケース 3: 複素固有値（Complex Eigenvalues）

### 目的
複素固有値を持つシステムで振動モードが正しく表示されることを確認

### 手順（減衰振動）
1. **タブ1: 状態方程式入力**に移動
2. 状態数を2に設定
3. A行列を以下のように入力:
   ```
   -1   -2
    2   -1
   ```
   （固有値: λ = -1 ± 2i、減衰振動）

4. **タブ3: 時間応答シミュレーション**に移動
5. 初期状態 x₁(0) = 1, x₂(0) = 0
6. 入力タイプ: ゼロ入力
7. シミュレーション時間: 10秒
8. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- ℹ️ 「システムは複素固有値を持ちます。応答に振動成分が含まれます。」と表示
- グラフで振動しながら減衰する応答が表示される

9. **タブ5: 固有値解析**に移動
10. 「固有値解析を実行」ボタンをクリック

### 期待される結果
- ℹ️ 「2個の複素固有値を検出しました。システムは振動的な応答を示します。」と表示
- テーブルに実部、虚部、絶対値が表示される
  - λ₁ = -1.0000 + 2.0000i
  - λ₂ = -1.0000 - 2.0000i
- s平面プロットで固有値が複素平面上に表示される（左半平面）
- モード説明で「減衰振動モード（固有周波数: 2.000 rad/s）」と表示

### 手順（持続振動）
1. A行列を以下のように変更:
   ```
   0   -1
   1    0
   ```
   （固有値: λ = ±i、純虚数）

2. 固有値解析を実行

### 期待される結果
- ⚠ 「システムは**限界安定**です（固有値の実部が0）」と表示
- モード説明で「持続振動モード（固有周波数: 1.000 rad/s）」と表示
- s平面プロットで固有値が虚軸上に表示される

---

## テストケース 4: 大きな行列（Large Matrices）

### 目的
5×5以上の行列で警告が表示され、10×10を超える行列が拒否されることを確認

### 手順（警告表示）
1. **タブ1: 状態方程式入力**に移動
2. 状態数を5に変更
3. 警告が表示されることを確認

### 期待される結果
- ⚠️ 「5×5以上の大きな行列は計算が重くなる可能性があります。教育目的として3×3以下を推奨します。」と表示
- 5×5の入力グリッドが表示される

### 手順（入力拒否）
1. 状態数を11に変更しようとする

### 期待される結果
- エラーメッセージが表示される
- 「エラー: 状態数は1～10の整数を入力してください。」
- 状態数が2にリセットされる

---

## テストケース 5: 数値オーバーフロー（Numerical Overflow）

### 目的
極端な値での計算でオーバーフローが検出されることを確認

### 手順
1. **タブ1: 状態方程式入力**に移動
2. 状態数を2に設定
3. A行列を以下のように入力:
   ```
   10   0
   0   10
   ```
   （非常に大きな固有値）

4. **タブ2: 状態遷移行列計算**に移動
5. 時刻 t = 10 を入力
6. 「Φ(t) を計算」ボタンをクリック

### 期待される結果
- ⚠️ 「計算結果に無限大の値が含まれます。システムが不安定または時刻が大きすぎる可能性があります。」と表示
- 行列の一部要素が ∞ として表示される

7. **タブ3: 時間応答シミュレーション**に移動
8. 初期状態 x₁(0) = 1, x₂(0) = 1
9. シミュレーション時間: 5秒
10. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- シミュレーションが途中で停止する
- 「シミュレーション中に数値オーバーフローが発生しました（t=X.XX秒）。システムが不安定すぎる可能性があります。」と表示

---

## テストケース 6: 無効な入力（Invalid Input）

### 目的
数値以外の入力や無効な値が適切に処理されることを確認

### 手順（状態数の検証）
1. **タブ1: 状態方程式入力**に移動
2. 状態数のフィールドに 0 を入力

### 期待される結果
- エラーメッセージが表示される
- 状態数がデフォルト値（2）にリセットされる

### 手順（時刻の検証）
1. **タブ2: 状態遷移行列計算**に移動
2. 時刻 t に -1 を入力
3. 「Φ(t) を計算」ボタンをクリック

### 期待される結果
- 「エラー: 時刻は0以上の数値を入力してください。」と表示
- 計算が実行されない

### 手順（初期状態の検証）
1. **タブ3: 時間応答シミュレーション**に移動
2. 初期状態のフィールドを空欄にする
3. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- 「エラー: 初期状態 xᵢ(0) に有効な数値を入力してください。」と表示
- シミュレーションが実行されない

### 手順（シミュレーション設定の検証）
1. シミュレーション時間: 1秒
2. サンプリング間隔: 2秒（シミュレーション時間より大きい）
3. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- 「エラー: サンプリング間隔は0より大きく、シミュレーション時間より小さい値を入力してください。」と表示

---

## テストケース 7: プロット点数制限

### 目的
プロット点数が自動的に制限されることを確認

### 手順
1. **タブ3: 時間応答シミュレーション**に移動
2. シミュレーション時間: 100秒
3. サンプリング間隔: 0.001秒（100,000点になる）
4. 「シミュレーション実行」ボタンをクリック

### 期待される結果
- ⚠️ 「サンプリング間隔を調整しました（プロット点数を10000以下に制限）。調整後の間隔: 0.0100秒」と表示
- グラフが正常に表示される（10,000点以下）

---

## テストケース 8: 位相面プロット制限

### 目的
2×2システム以外で位相面プロットが制限されることを確認

### 手順
1. **タブ1: 状態方程式入力**に移動
2. 状態数を3に変更
3. **タブ4: 状態軌道・位相面**に移動
4. 「位相面を描画」ボタンをクリック

### 期待される結果
- ⚠️ 「このツールは2×2システムでのみ動作します。タブ1で状態数を2に設定してください。」と表示
- プロットが実行されない

---

## テストケース 9: XSS対策

### 目的
ユーザー入力が安全に処理されることを確認

### 手順
1. **タブ1: 状態方程式入力**に移動
2. A行列の要素に以下を入力しようとする:
   - `<script>alert('XSS')</script>`
   - `<img src=x onerror=alert('XSS')>`
   - `javascript:alert('XSS')`

### 期待される結果
- 入力フィールドは type="number" なので、文字列の入力が制限される
- もし入力できても、parseFloat() で数値に変換され、無効な場合は0になる
- スクリプトが実行されない
- アラートが表示されない

---

## テストケース 10: エラーメッセージの品質

### 目的
エラーメッセージが分かりやすく、対処法が示されていることを確認

### 確認項目
各エラーメッセージに以下が含まれているか:
1. **何が問題か**: エラーの種類が明確
2. **なぜ問題か**: 原因の説明
3. **どう対処するか**: ユーザーが取るべきアクション

### 例
- ✅ 良い例: 「計算エラー: 数値計算が失敗しました（NaN発生）。行列の値や時刻を確認してください。」
- ❌ 悪い例: 「エラーが発生しました。」

---

## テスト完了チェックリスト

- [ ] テストケース 1: 特異行列 - 合格
- [ ] テストケース 2: 不安定システム - 合格
- [ ] テストケース 3: 複素固有値 - 合格
- [ ] テストケース 4: 大きな行列 - 合格
- [ ] テストケース 5: 数値オーバーフロー - 合格
- [ ] テストケース 6: 無効な入力 - 合格
- [ ] テストケース 7: プロット点数制限 - 合格
- [ ] テストケース 8: 位相面プロット制限 - 合格
- [ ] テストケース 9: XSS対策 - 合格
- [ ] テストケース 10: エラーメッセージの品質 - 合格
- [ ] ブラウザコンソールにエラーがない
- [ ] すべての機能が正常に動作する

---

## トラブルシューティング

### CDNライブラリが読み込めない
- インターネット接続を確認
- ブラウザのキャッシュをクリア
- 別のブラウザで試す

### グラフが表示されない
- Plotly.jsが正しく読み込まれているか確認
- ブラウザコンソールでエラーを確認

### 数式が表示されない
- KaTeXが正しく読み込まれているか確認
- ページを再読み込み

### 計算結果がおかしい
- 入力した行列の値を確認
- 数値精度の限界（非常に大きな/小さな値）
- Math.jsのドキュメントを参照

---

## まとめ

すべてのテストケースが合格すれば、エッジケース処理の実装は完了です。
各エッジケースに対して適切な警告やエラーメッセージが表示され、
システムがクラッシュすることなく安全に動作することを確認してください。
