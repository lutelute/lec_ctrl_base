# 第12章 制御系の定常特性 - 理解者編

## 1. 内部モデル原理 (Internal Model Principle)

### 内部モデル原理とは

**内部モデル原理 (internal model principle)** は、制御理論における重要な基本原理の一つです。この原理は、次のように述べられます：

> フィードバック制御系において、ある種の入力信号や外乱に対して定常偏差をゼロにするためには、コントローラがその信号を生成する動的システム（内部モデル）を含んでいなければならない。

この原理は、1970年代にFrancis と Wonhamによって形式化され、制御系設計の基本指針となっています。

### 数学的定式化

単位フィードバック系を考えます。外部信号（目標値 $r(t)$ や外乱 $d(t)$）が次の微分方程式で生成されるとします：

$$\dot{\xi} = A_e \xi$$
$$w(t) = C_e \xi$$

ここで、$w(t)$ は外部信号、$\xi$ は外部信号の生成器の状態です。

**内部モデル原理の定理**：定常偏差をゼロにするためには、コントローラの伝達関数 $C(s)$ が次の因子を含む必要があります：

$$C(s) = \frac{N(s)}{D(s)}, \quad \det(sI - A_e) \mid D(s)$$

すなわち、コントローラは外部信号生成器の特性多項式 $\det(sI - A_e)$ を分母に持つ必要があります。

### 具体例：積分器の役割

最も基本的な例として、**ステップ入力**を考えます。ステップ信号は次の微分方程式で生成されます：

$$\dot{\xi} = 0, \quad r(t) = \xi$$

特性多項式は $\det(sI - 0) = s$ です。したがって、内部モデル原理により、コントローラは因子 $s$ を分母に持つ必要があります：

$$C(s) = \frac{N(s)}{s \cdot D_1(s)}$$

これは、コントローラが**積分器 ($1/s$)** を含むことを意味します。これが、I動作（積分動作）によってステップ入力に対する定常偏差がゼロになる理由です。

同様に、**ランプ入力** $r(t) = t$ を完全に追従するには：

$$\dot{\xi}_1 = \xi_2, \quad \dot{\xi}_2 = 0, \quad r(t) = \xi_1$$

特性多項式は $s^2$ なので、コントローラは**2重積分器 ($1/s^2$)** を含む必要があります。

### システムの型との関係

内部モデル原理は、システムの型と定常偏差の関係を理論的に説明します：

- **Type 1 システム**：開ループ伝達関数が $1/s$ を含む → ステップ入力の内部モデルを持つ → ステップ入力に対して $e_{ss} = 0$
- **Type 2 システム**：開ループ伝達関数が $1/s^2$ を含む → ランプ入力の内部モデルを持つ → ランプ入力に対して $e_{ss} = 0$

## 2. 定常偏差の理論的導出

### 閉ループ系の偏差伝達関数

一般的なフィードバック制御系を考えます。コントローラ $C(s)$、プラント $P(s)$、フィードバック要素 $H(s)$ を持つシステムの偏差伝達関数は：

$$E(s) = \frac{R(s)}{1 + C(s)P(s)H(s)}$$

単位フィードバック系（$H(s) = 1$）の場合：

$$E(s) = \frac{R(s)}{1 + C(s)P(s)} = \frac{R(s)}{1 + L(s)}$$

ここで、$L(s) = C(s)P(s)$ は**ループ伝達関数 (loop transfer function)** です。

### 感度関数との関係

偏差伝達関数は、制御系の**感度関数 (sensitivity function)** $S(s)$ と一致します：

$$S(s) = \frac{1}{1 + L(s)}$$

感度関数は、外乱や不確かさに対する制御系のロバスト性を表す重要な指標です。

最終値定理を適用すると：

$$e_{ss} = \lim_{s \to 0} sR(s)S(s) = \lim_{s \to 0} \frac{sR(s)}{1 + L(s)}$$

### 周波数領域での解釈

定常偏差をゼロにするには、$s \to 0$ において $S(0) = 0$ とする必要があります。これは：

$$\lim_{s \to 0} \frac{1}{1 + L(s)} = 0 \quad \Leftrightarrow \quad \lim_{s \to 0} L(s) = \infty$$

つまり、**低周波数域でループゲインを無限大にする**ことが定常偏差をゼロにする条件です。これは積分器によって実現されます。

### ロバスト性と定常特性のトレードオフ

感度関数 $S(s)$ と相補感度関数 $T(s) = 1 - S(s)$ には次の関係があります：

$$S(s) + T(s) = 1$$

この制約により、以下のトレードオフが生じます：

- 低周波数域で $S(\omega) \to 0$ とすると（定常偏差を小さくする）、高周波数域で $S(\omega)$ が大きくなる可能性がある（ノイズに対する感度が高まる）
- 過度な積分動作は、系を不安定化させる可能性がある

これが、制御系設計における**性能とロバスト性のトレードオフ**の一例です。

## 3. 外乱に対する定常偏差

### 外乱が入力側に入る場合

外乱 $d(t)$ がプラントの入力側に加わる場合を考えます：

```
R(s) → C(s) → (+) → P(s) → Y(s)
               ↑
              D(s)
```

このとき、出力は：

$$Y(s) = \frac{C(s)P(s)}{1 + C(s)P(s)}R(s) + \frac{P(s)}{1 + C(s)P(s)}D(s)$$

外乱による定常偏差（$R(s) = 0$ のとき）は：

$$e_{ss,d} = -\lim_{s \to 0} sY(s) = -\lim_{s \to 0} \frac{sP(s)D(s)}{1 + C(s)P(s)}$$

### 外乱が出力側に入る場合

外乱 $d(t)$ がプラントの出力側に加わる場合：

```
R(s) → C(s) → P(s) → (+) → Y(s)
                      ↑
                     D(s)
```

出力は：

$$Y(s) = \frac{C(s)P(s)}{1 + C(s)P(s)}R(s) + \frac{1}{1 + C(s)P(s)}D(s)$$

外乱による定常偏差は：

$$e_{ss,d} = -\lim_{s \to 0} sY(s) = -\lim_{s \to 0} \frac{sD(s)}{1 + C(s)P(s)}$$

### 外乱除去と積分動作

ステップ外乱 $D(s) = d_0/s$ に対して定常偏差をゼロにするには：

$$e_{ss,d} = -\lim_{s \to 0} \frac{d_0}{1 + C(s)P(s)} = 0$$

これには $\lim_{s \to 0} C(s)P(s) = \infty$ が必要です。つまり、**コントローラかプラントが積分器を含む**必要があります。

内部モデル原理の観点から見ると、ステップ外乱を除去するには、閉ループ系がステップ信号の内部モデル（積分器）を含む必要があるということです。

## 4. PID制御と定常特性

### I動作（積分動作）による定常偏差の除去

PID制御器は次の形式で表されます：

$$C(s) = K_p + \frac{K_i}{s} + K_d s = K_p \left(1 + \frac{1}{T_i s} + T_d s\right)$$

ここで：
- $K_p$：比例ゲイン
- $K_i = K_p/T_i$：積分ゲイン、$T_i$：積分時間
- $K_d = K_p T_d$：微分ゲイン、$T_d$：微分時間

**I動作（積分動作）** の役割：

1. **定常偏差の除去**：積分器 $1/s$ を含むため、ステップ入力・外乱に対して $e_{ss} = 0$
2. **低周波ゲインの増大**：低周波数域でゲインが無限大になり、感度を低減
3. **内部モデルの実現**：ステップ信号の内部モデルを実現

### 積分動作の数学的効果

積分動作を含むコントローラで制御される Type 0 プラント $P(s) = K/(s+a)$ を考えます。

PI制御 $C(s) = K_p(1 + 1/(T_i s))$ を用いると、ループ伝達関数は：

$$L(s) = C(s)P(s) = \frac{K_p K(T_i s + 1)}{T_i s(s + a)}$$

これは Type 1 システムになります。ステップ入力に対する定常偏差は：

$$e_{ss} = \lim_{s \to 0} \frac{s \cdot 1/s}{1 + L(s)} = \lim_{s \to 0} \frac{1}{1 + \infty} = 0$$

### アンチワインドアップの必要性

積分動作には**ワインドアップ (windup)** と呼ばれる問題があります。

**ワインドアップ現象**：
- 制御量が飽和（アクチュエータの制約）しているとき、積分項は偏差を蓄積し続ける
- 飽和が解除された後、過大な積分項により大きなオーバーシュートが発生

**アンチワインドアップ対策**：
1. **条件付き積分**：偏差が一定値以下のときのみ積分
2. **積分項の制限**：積分項の値に上下限を設定
3. **バックカリキュレーション**：飽和時に積分項を調整

実装例（疑似コード）：

```
if (|error| < threshold) {
    integral += error * dt;
}
integral = clamp(integral, integral_min, integral_max);
```

### 実システムでの考慮点

実際の制御系では、以下の点に注意が必要です：

1. **積分時間の調整**：$T_i$ が小さすぎると不安定化、大きすぎると効果が弱い
2. **測定ノイズ**：積分動作はノイズも蓄積するため、フィルタリングが必要
3. **非線形性**：飽和、不感帯、ヒステリシスなどがあると理論通りにならない
4. **離散化の影響**：デジタル実装では、サンプリング周期と積分の離散化誤差を考慮

## 5. 発展的話題

### 多入力多出力（MIMO）システムへの拡張

**MIMO (Multi-Input Multi-Output) システム**では、内部モデル原理は次のように拡張されます：

$$\mathbf{C}(s) = \frac{\mathbf{N}(s)}{\mathbf{D}(s)}$$

各入力チャネルに対して独立に内部モデルを持つのではなく、システム全体として外部信号の内部モデルを含む必要があります。

定常偏差のベクトル $\mathbf{e}_{ss}$ は：

$$\mathbf{e}_{ss} = \lim_{s \to 0} s[\mathbf{I} + \mathbf{L}(s)]^{-1}\mathbf{R}(s)$$

ここで、$\mathbf{L}(s) = \mathbf{C}(s)\mathbf{P}(s)$ はループ伝達行列です。

### 追従問題と制御問題の関係

制御問題は、大きく2つに分類されます：

1. **レギュレーション問題 (regulation problem)**：外乱を抑制し、出力を一定値に保つ
2. **サーボ問題 (servo problem)**：時変の目標値に出力を追従させる

定常偏差の問題は、サーボ問題における重要な性能指標です。内部モデル原理は、両方の問題に対して統一的な設計指針を与えます。

### 現代制御理論との接続

状態空間表現における内部モデル原理は、以下のように定式化されます。

プラント：
$$\dot{\mathbf{x}} = A\mathbf{x} + B\mathbf{u}$$
$$\mathbf{y} = C\mathbf{x}$$

外部信号生成器：
$$\dot{\xi} = A_e \xi$$
$$\mathbf{w} = C_e \xi$$

**サーボ補償器 (servo compensator)** を設計します：

$$\dot{\mathbf{z}} = A_e \mathbf{z} + B_e \mathbf{e}$$
$$\mathbf{u} = -K_x \mathbf{x} - K_z \mathbf{z}$$

ここで、$\mathbf{z}$ はサーボ補償器の状態、$\mathbf{e} = \mathbf{r} - \mathbf{y}$ は偏差です。

サーボ補償器の動特性 $A_e$ は、外部信号生成器の $A_e$ と同じ構造を持ちます。これが、状態空間における内部モデル原理の実現です。

### 適応制御とロバスト制御への発展

内部モデル原理は、より高度な制御手法にも拡張されています：

1. **適応サーボ系**：外部信号のパラメータが未知の場合、オンラインで内部モデルのパラメータを推定
2. **ロバストサーボ系**：プラント不確かさが存在する場合でも定常偏差をゼロに保証
3. **反復学習制御 (ILC)**：周期的な目標値に対して、試行を繰り返すことで完全追従を実現

これらの手法は、基本的な内部モデル原理の概念を基礎として発展したものです。

## まとめ

- **内部モデル原理**は、定常偏差をゼロにするための理論的基礎を与える
- コントローラが追従・除去すべき信号の動的モデルを含む必要がある
- 感度関数 $S(s)$ の低周波特性が定常偏差を決定する
- PIDのI動作は、ステップ信号の内部モデルを実現する
- 外乱除去にも内部モデル原理が適用される
- 性能とロバスト性のトレードオフを考慮した設計が重要
- MIMOシステム、現代制御理論、適応制御へと理論が発展している

内部モデル原理を理解することで、定常特性の本質的なメカニズムが見えてきます。この原理は、古典制御理論と現代制御理論を結ぶ重要な概念であり、実用的な制御系設計の指針となります。
