# 第14章 制御系の設計 - 中級編

## 1. PI制御の設計 (Proportional-Integral Control)

### 1.1 PI制御の動作原理

初級編で学んだP制御の最大の問題は、**定常偏差 (steady-state error)** が残ることでした。この問題を解決するために、**積分 (integral)** 動作を追加したものが **PI制御 (proportional-integral control)** です。

PI制御の制御入力は次式で表されます：

$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau$$

ここで、
- $K_p$: 比例ゲイン (proportional gain)
- $K_i$: 積分ゲイン (integral gain)
- $e(t)$: 偏差 (error)

積分項は、過去の偏差を累積して制御入力に反映します。これにより、偏差が残り続ける限り制御入力が増加し続けるため、定常偏差を完全にゼロにすることができます。

### 1.2 PI制御の伝達関数

ラプラス変換を用いると、PI制御器の伝達関数は次のように表されます：

$$C(s) = K_p + \frac{K_i}{s}$$

これを変形すると：

$$C(s) = \frac{K_p s + K_i}{s} = K_p \frac{s + \frac{K_i}{K_p}}{s}$$

この形から、PI制御器は：
- **極 (pole)** を原点 $s = 0$ に持つ
- **零点 (zero)** を $s = -\frac{K_i}{K_p}$ に持つ

ことがわかります。

### 1.3 積分動作の効果

積分動作が定常偏差を解消する理由を理解するために、最終値定理を用いて定常偏差を求めます。

1型システム（分母に $s$ を1つ持つシステム）に対してステップ入力が加わった場合、定常偏差は：

$$e_{ss} = \lim_{s \to 0} s \cdot \frac{R/s}{1 + C(s)G(s)} = \lim_{s \to 0} \frac{R}{1 + C(s)G(s)}$$

PI制御では $C(s)$ の分子に $s$ が含まれるため、$s \to 0$ のとき $C(s) \to \infty$ となり、結果として $e_{ss} = 0$ となります。

**例**:
- プラント $G(s) = \frac{1}{s+1}$ にPI制御を適用
- ステップ入力 $r(t) = 1$ に対して、時間が十分経過すると $e(t) \to 0$
- P制御では定常偏差が残っていましたが、PI制御では完全にゼロになります

> **注意**: 積分動作は定常偏差を解消する一方で、応答が振動的になったり、オーバーシュートが大きくなったりする場合があります。

### 1.4 PI制御の設計手順

PI制御を設計する際の基本的な手順：

1. **P制御で基本特性を確認**: まず $K_i = 0$ としてP制御で安定化
2. **積分ゲインを追加**: 小さな $K_i$ から始める
3. **定常偏差の確認**: 積分動作により定常偏差がゼロになることを確認
4. **過渡応答の調整**: オーバーシュートや整定時間を確認しながら両ゲインを調整

---

## 2. PID制御の設計 (Proportional-Integral-Derivative Control)

### 2.1 PID制御の動作原理

**PID制御 (proportional-integral-derivative control)** は、P制御、I制御、D制御を組み合わせた最も一般的な制御方式です。制御入力は次式で表されます：

$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

ここで、
- $K_p$: 比例ゲイン (proportional gain)
- $K_i$: 積分ゲイン (integral gain)
- $K_d$: 微分ゲイン (derivative gain)

**微分項 (derivative term)** は、偏差の変化率に比例した制御入力を生成します。これにより、将来の偏差を予測して先回りした制御が可能になります。

### 2.2 PID制御の伝達関数

PID制御器の伝達関数は次のように表されます：

$$C(s) = K_p + \frac{K_i}{s} + K_d s$$

これを変形すると：

$$C(s) = \frac{K_d s^2 + K_p s + K_i}{s}$$

この形から、PID制御器は：
- **極 (pole)** を原点 $s = 0$ に持つ
- **2つの零点** を持つ（$K_d s^2 + K_p s + K_i = 0$ の解）

### 2.3 各パラメータの役割

PID制御の3つのパラメータは、それぞれ異なる役割を持ちます：

| パラメータ | 役割 | 効果 | 副作用 |
|-----------|------|------|--------|
| $K_p$ (比例) | 現在の偏差に応答 | 応答速度の向上 | オーバーシュート増加 |
| $K_i$ (積分) | 過去の偏差を累積 | 定常偏差の解消 | 振動、整定時間の増加 |
| $K_d$ (微分) | 偏差の変化に先回り | オーバーシュート抑制、安定化 | ノイズに敏感 |

### 2.4 微分動作の効果

微分動作は、偏差が急激に変化するとき（例えば、目標値が変化した直後）に大きな制御入力を生成します。これにより：

1. **オーバーシュートの抑制**: 偏差が減少し始めたら制御入力を弱める
2. **減衰特性の改善**: 振動を素早く減衰させる
3. **位相進み効果**: システムの位相遅れを補償

**例**:
- 車のブレーキ制御
  - P動作: 目標速度との差に応じてブレーキ
  - I動作: 速度が高いまま続くと徐々にブレーキを強める
  - D動作: 速度が急激に変化しているときにブレーキを強める

> **注意**: 微分動作はノイズを増幅する性質があるため、測定ノイズが大きい系では使用に注意が必要です。実用的には、微分動作にローパスフィルタを組み合わせることが多いです。

### 2.5 PID制御の実装形式

実際のPID制御では、微分項を実装可能な形に修正することがあります：

**標準形 (standard form)**:
$$C(s) = K_p \left( 1 + \frac{1}{T_i s} + T_d s \right)$$

ここで、$T_i = K_p / K_i$ は積分時間、$T_d = K_d / K_p$ は微分時間です。

**実用微分形 (practical derivative)**:
$$C(s) = K_p + \frac{K_i}{s} + \frac{K_d s}{1 + \frac{T_d s}{N}}$$

分母の $N$ は微分フィルタの係数で、通常 $N = 5 \sim 20$ 程度に設定します。

---

## 3. Ziegler-Nichols法によるチューニング (Ziegler-Nichols Tuning Method)

### 3.1 Ziegler-Nichols法とは

**Ziegler-Nichols法 (Ziegler-Nichols method)** は、PIDパラメータを体系的に決定する古典的な調整法です。1942年にZieglerとNicholsによって提案され、現在でも広く使用されています。

この方法には2つの手法があります：
1. **限界感度法 (ultimate sensitivity method)**
2. **ステップ応答法 (step response method)**

### 3.2 限界感度法（第1法）

限界感度法は、システムを継続振動させる限界のゲインと周期を用いてPIDパラメータを決定します。

**手順**:

1. **I動作とD動作を無効化**: $K_i = 0$, $K_d = 0$ として、P制御のみとする
2. **限界ゲインを求める**: $K_p$ を徐々に増加させ、システムが持続振動する限界のゲイン $K_u$ (ultimate gain) を求める
3. **限界周期を測定**: 持続振動の周期 $T_u$ (ultimate period) を測定する
4. **PIDパラメータを計算**: 以下の表に従ってパラメータを決定する

| 制御器 | $K_p$ | $T_i$ | $T_d$ | $K_i$ | $K_d$ |
|--------|-------|-------|-------|-------|-------|
| P      | $0.5 K_u$ | - | - | - | - |
| PI     | $0.45 K_u$ | $T_u / 1.2$ | - | $0.54 K_u / T_u$ | - |
| PID    | $0.6 K_u$ | $T_u / 2$ | $T_u / 8$ | $1.2 K_u / T_u$ | $0.075 K_u T_u$ |

**例**:
- 実験で $K_u = 10$、$T_u = 2$ [s] が得られた場合
- PID制御のパラメータは：
  - $K_p = 0.6 \times 10 = 6$
  - $K_i = 1.2 \times 10 / 2 = 6$
  - $K_d = 0.075 \times 10 \times 2 = 1.5$

### 3.3 ステップ応答法（第2法）

ステップ応答法は、プラントの開ループステップ応答から特性値を読み取り、PIDパラメータを決定します。

**手順**:

1. **開ループでステップ応答を測定**: 制御器を外した状態でステップ入力を加える
2. **応答曲線を記録**: 出力 $y(t)$ の時間変化を記録する
3. **特性値の抽出**: 応答曲線の変曲点における接線を引き、以下を求める
   - $L$: 無駄時間 (dead time)
   - $T$: 時定数 (time constant)
   - $K$: ゲイン定数
4. **PIDパラメータを計算**: 以下の表に従ってパラメータを決定する

| 制御器 | $K_p$ | $T_i$ | $T_d$ |
|--------|-------|-------|-------|
| P      | $T / (K L)$ | - | - |
| PI     | $0.9 T / (K L)$ | $L / 0.3$ | - |
| PID    | $1.2 T / (K L)$ | $2L$ | $0.5L$ |

**例**:
- ステップ応答から $K = 2$、$L = 0.5$ [s]、$T = 3$ [s] が得られた場合
- PID制御のパラメータは：
  - $K_p = 1.2 \times 3 / (2 \times 0.5) = 3.6$
  - $T_i = 2 \times 0.5 = 1$ [s]
  - $T_d = 0.5 \times 0.5 = 0.25$ [s]

### 3.4 Ziegler-Nichols法の特徴

**利点**:
- 体系的で再現性がある
- 数学モデルが不要
- 実用的な初期値を素早く得られる

**欠点**:
- オーバーシュートが大きくなる傾向（約25%程度）
- すべてのシステムに最適とは限らない
- 微調整が必要な場合が多い

> **注意**: Ziegler-Nichols法で得られたパラメータは、あくまで初期値として使用し、実際のシステムの要求仕様に合わせて微調整することが推奨されます。

---

## 4. 根軌跡法の基礎 (Root Locus Method)

### 4.1 根軌跡法とは

**根軌跡法 (root locus method)** は、制御ゲインを変化させたときに閉ループ系の極（根）がどのように移動するかを図示する手法です。1948年にW. R. Evansによって提案されました。

根軌跡を用いることで：
- ゲインと極の位置の関係を視覚的に理解できる
- 安定性の判定が容易になる
- 所望の極配置を実現するゲインを決定できる

### 4.2 根軌跡の基本概念

フィードバック制御系の閉ループ伝達関数は：

$$T(s) = \frac{KG(s)}{1 + KG(s)}$$

ここで、$K$ は調整可能なゲイン、$G(s)$ はプラントと制御器の伝達関数です。

閉ループの極は、特性方程式 $1 + KG(s) = 0$ の解として求められます：

$$KG(s) = -1$$

これは次の2つの条件と等価です：
1. **振幅条件**: $|KG(s)| = 1$
2. **位相条件**: $\angle G(s) = 180° + 360° n$ （$n$ は整数）

**根軌跡** は、ゲイン $K$ を $0$ から $\infty$ まで変化させたときに、この条件を満たす $s$ の軌跡を複素平面上に描いたものです。

### 4.3 根軌跡の性質

開ループ伝達関数 $G(s)$ が $m$ 個の零点と $n$ 個の極を持つとき、根軌跡は以下の性質を持ちます：

1. **軌跡の数**: $n$ 本の軌跡が存在する（極の数だけ）
2. **起点**: $K = 0$ のとき、根軌跡は開ループの極から始まる
3. **終点**: $K \to \infty$ のとき、根軌跡は開ループの零点（$m$ 個）または無限遠点（$n - m$ 本）へ向かう
4. **実軸上の軌跡**: 実軸上で、右側に存在する極と零点の総数が奇数である区間が根軌跡となる
5. **対称性**: 実数係数の系では、根軌跡は実軸に関して対称

### 4.4 根軌跡の描き方（基本）

簡単な例として、開ループ伝達関数が次の場合を考えます：

$$G(s) = \frac{1}{s(s+2)}$$

この系には：
- 極：$s = 0, -2$（2個）
- 零点：なし（0個）

根軌跡の性質から：
1. 2本の軌跡が存在
2. $s = 0$ と $s = -2$ から始まる
3. 両方とも無限遠点へ向かう（零点が0個のため）
4. 実軸上の $s < -2$ と $-2 < s < 0$ の区間が根軌跡

ゲイン $K$ が増加すると、2つの極は実軸上を互いに近づき、ある点で衝突して実軸を離れ、複素共役極となって上下に分かれます。

### 4.5 根軌跡と制御性能

根軌跡上の極の位置は、システムの過渡応答特性を表します：

**実軸上の極**:
- 実軸の負の側：安定な非振動応答
- 実軸の正の側：不安定な応答

**複素共役極 $s = -\sigma \pm j\omega$**:
- 実部 $-\sigma$：減衰率を表す（負で大きいほど速く減衰）
- 虚部 $\pm j\omega$：振動周波数を表す（大きいほど速い振動）
- 減衰比：$\zeta = \frac{\sigma}{\sqrt{\sigma^2 + \omega^2}}$

**例**:
- 極が $s = -1 \pm j2$ の位置にある場合
  - 減衰時定数：約 $1/1 = 1$ 秒
  - 振動周波数：$\omega = 2$ rad/s
  - 減衰比：$\zeta = 1/\sqrt{1+4} \approx 0.45$（不足減衰）

### 4.6 根軌跡を用いたゲイン調整

根軌跡法による設計手順：

1. **開ループ伝達関数を求める**: $G(s) = C(s)P(s)$
2. **根軌跡を描く**: $K$ を変化させたときの極の軌跡を図示
3. **所望の極位置を決定**: 要求仕様（整定時間、オーバーシュートなど）から望ましい極の位置を決める
4. **ゲインを決定**: その極位置を実現する $K$ の値を求める

**例**:
- 要求仕様：整定時間 2秒以下、オーバーシュート 10% 以下
- この仕様から、減衰比 $\zeta \geq 0.6$、実部 $\sigma \geq 2$ が求まる
- 根軌跡上で、これらの条件を満たす極の位置を見つける
- その位置に対応するゲイン $K$ を計算する

> **注意**: 根軌跡法は、ゲインだけでなく、補償器（位相進み/遅れ補償器など）の設計にも応用できます。これについては理解者向け編で詳しく学習します。

---

## 5. 実践的な設計手順

### 5.1 PID制御系の設計フロー

実際の制御系設計では、以下のような手順で進めます：

1. **システムの同定**: プラントの特性を測定または推定
2. **制御仕様の明確化**: 整定時間、オーバーシュート、定常偏差などの要求仕様を定義
3. **制御方式の選択**: P、PI、PIDのいずれかを選択
4. **初期パラメータの決定**: Ziegler-Nichols法などで初期値を設定
5. **根軌跡による検証**: 安定性と過渡特性を確認
6. **シミュレーション**: 計算機上で応答を確認
7. **実機調整**: 実際のシステムで微調整

### 5.2 制御方式の選択指針

どの制御方式を選ぶかは、システムの特性と要求仕様によって決まります：

| 制御方式 | 適用場面 | 長所 | 短所 |
|---------|---------|------|------|
| P制御 | 定常偏差が許容できる場合 | 簡単、安定 | 定常偏差が残る |
| PI制御 | 定常偏差ゼロが必要な場合 | 定常偏差解消 | 応答が遅い、振動的 |
| PID制御 | 高速・高精度が必要な場合 | 最良の応答 | 調整が複雑、ノイズに敏感 |

### 5.3 パラメータ調整のコツ

実際の調整では、以下の経験則が役立ちます：

**オーバーシュートが大きい場合**:
- $K_p$ を減らす
- $K_d$ を増やす

**整定時間が長い場合**:
- $K_p$ を増やす
- $K_i$ を増やす

**振動が続く場合**:
- $K_i$ を減らす
- $K_d$ を増やす

**定常偏差が残る場合**:
- $K_i$ を増やす（PI/PID制御の場合）
- P制御ならPI制御に変更

---

## まとめ

この中級編では、以下を学びました：

- **PI制御の設計**: 積分動作により定常偏差を完全に解消できる
- **PI制御器の伝達関数**: $C(s) = K_p + K_i/s$ は原点に極を持つ
- **PID制御の設計**: P、I、Dの3つの動作を組み合わせた万能制御器
- **各パラメータの役割**: $K_p$ は応答速度、$K_i$ は定常偏差解消、$K_d$ はオーバーシュート抑制
- **Ziegler-Nichols法**: 限界感度法とステップ応答法によるPIDパラメータの体系的決定法
- **根軌跡法の基礎**: ゲイン変化に対する閉ループ極の軌跡を視覚化する手法
- **根軌跡の性質**: 開ループの極から始まり、零点または無限遠へ向かう
- **根軌跡を用いた設計**: 所望の極配置からゲインを決定する手順
- **実践的な設計手順**: システム同定から実機調整までの流れ

次の理解者向け編では、根軌跡法の詳細な作図規則、補償器設計、より高度な設計最適化について学習します。
